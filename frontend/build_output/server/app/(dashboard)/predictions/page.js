(()=>{var e={};e.id=97,e.ids=[97],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},74026:e=>{"use strict";e.exports=require("string_decoder")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},12536:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>l}),r(33720),r(68032),r(35866),r(48457);var s=r(23191),n=r(88716),i=r(37922),o=r.n(i),d=r(95231),a={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(a[e]=()=>d[e]);r.d(t,a);let l=["",{children:["(dashboard)",{children:["predictions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,33720)),"C:\\Data-Science-Project\\Customer-Segmentation-Retention-Analysis\\frontend\\app\\(dashboard)\\predictions\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,68032)),"C:\\Data-Science-Project\\Customer-Segmentation-Retention-Analysis\\frontend\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,48457)),"C:\\Data-Science-Project\\Customer-Segmentation-Retention-Analysis\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Data-Science-Project\\Customer-Segmentation-Retention-Analysis\\frontend\\app\\(dashboard)\\predictions\\page.tsx"],u="/(dashboard)/predictions/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(dashboard)/predictions/page",pathname:"/predictions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},70183:(e,t,r)=>{Promise.resolve().then(r.bind(r,44444))},44444:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(10326),n=r(17577),i=r(20108),o=r(33071),d=r(25517),a=r(90434),l=r(34474),c=r(54432),u=r(90772),p=r(70209),m=r(53812),x=r(94019),h=r(77863);function f(e){if(!e)return"—";let t=null;if(e instanceof Date&&(t=e),"number"==typeof e&&(t=new Date(e)),"string"==typeof e){let r=new Date(e);t=Number.isNaN(r.getTime())?null:r}if(e.seconds&&(t=new Date(1e3*e.seconds)),e._seconds&&(t=new Date(1e3*e._seconds)),e.toDate&&(t=e.toDate()),e.toMillis&&(t=new Date(e.toMillis())),!t)return"—";let r=Date.now()-t.getTime();if(r<0)return"just now";let s=Math.floor(r/1e3),n=Math.floor(s/60),i=Math.floor(n/60),o=Math.floor(i/24),d=Math.floor(o/30);return s<60?`${s}s ago`:n<60?`${n}m ago`:i<24?`${i}h ago`:o<30?`${o}d ago`:d<12?`${d}mo ago`:`${Math.floor(o/365)}y ago`}function g(){let{user:e}=(0,p.a)(),{push:t}=(0,m.p)(),[r,g]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1),[N,w]=(0,n.useState)("single"),[_,q]=(0,n.useState)(!1),[S,P]=(0,n.useState)(!1),[C,D]=(0,n.useState)([]);(0,n.useRef)(0);let k=(0,i.a)({queryKey:["models"],queryFn:d.h.models,refetchInterval:5e3}),B=(0,i.a)({queryKey:["predictions"],queryFn:d.h.predictions,refetchInterval:5e3});(0,n.useMemo)(()=>(B.data??[]).filter(e=>e.payload?.mode==="batch"),[B.data]);let $=(0,n.useMemo)(()=>{let e=new Map;return(k.data??[]).forEach(t=>{e.set(t.model_id,t.name)}),e},[k.data]),I=(0,n.useMemo)(()=>[...C.map(e=>({prediction_id:e.tempId,payload:{model_id:e.modelId,mode:e.mode},created_at:new Date(e.createdAt).toISOString(),isQueued:!0})),...B.data??[]],[C,B.data]),M=C.length,A=async()=>{if(!e){t({title:"Login required.",description:"Sign in to run predictions.",tone:"error"});return}if(!r){t({title:"Select a model.",description:"Choose a trained model first.",tone:"error"});return}let s=Number(b);if(!s){t({title:"Enter a valid customer ID.",description:"Use a numeric customer ID.",tone:"error"});return}q(!0);try{await d.h.queueSinglePrediction({tenant_id:e.uid,model_id:r,customer_id:s,notify_email:e.email}),t({title:"Single prediction queued.",description:"We will email you when the result is ready.",tone:"success"}),D(e=>[{tempId:`queued-${Date.now()}-single`,modelId:r,createdAt:Date.now(),mode:"single"},...e]),j(""),v(!1)}catch(e){t({title:"Prediction failed.",description:"Check the customer ID and API connection.",tone:"error"})}finally{q(!1)}},T=async()=>{if(!e){t({title:"Login required.",description:"Sign in to run predictions.",tone:"error"});return}if(!r){t({title:"Select a model.",description:"Choose a trained model first.",tone:"error"});return}P(!0);try{await d.h.queueBatchPrediction({tenant_id:e.uid,model_id:r,notify_email:e.email}),D(e=>[{tempId:`queued-${Date.now()}-batch`,modelId:r,createdAt:Date.now(),mode:"batch"},...e]),t({title:"Batch prediction queued.",description:"We will email you when the file is ready.",tone:"success"}),v(!1)}catch(e){t({title:"Batch prediction failed.",description:"Check the API connection and try again.",tone:"error"})}finally{P(!1)}};return(0,s.jsxs)(o.Zb,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[s.jsx(o.ll,{children:"Prediction Console"}),s.jsx(o.SZ,{children:"Run single or batch predictions and review batch history."})]}),s.jsx(u.z,{onClick:()=>v(!0),children:"Create prediction"})]}),(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Prediction runs"}),s.jsx("p",{className:"text-xs text-muted",children:M?`${M} queued`:"Open a run to view full results."})]}),s.jsx(u.z,{variant:"ghost",className:"h-9",onClick:()=>B.refetch(),disabled:B.isFetching,children:"Refresh"})]}),(0,s.jsxs)("div",{className:"mt-3 grid gap-3",children:[0===I.length&&s.jsx("div",{className:"rounded-xl border border-panelBorder bg-background p-4 text-sm text-muted",children:"No batch runs yet."}),I.map(e=>e.isQueued?s.jsx("div",{className:"rounded-xl border border-panelBorder bg-background p-4 opacity-70",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:e.payload?.mode==="single"?"Single prediction":"Batch prediction"}),(0,s.jsxs)("p",{className:"text-xs text-muted",children:["Model: ",$.get(e.payload?.model_id)||"—"," \xb7"," ",f(e.created_at)]})]}),s.jsx("span",{className:"rounded-full border border-panelBorder bg-panel px-2 py-1 text-xs text-muted",children:"Queued"})]})},e.prediction_id):s.jsx(a.default,{href:e.payload?.mode==="batch"?`/predictions/batch/${e.prediction_id}`:`/predictions/${e.prediction_id}`,className:"rounded-xl border border-panelBorder bg-background p-4 transition hover:border-accent/60",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:e.payload?.mode==="single"?"Single prediction":"Batch prediction"}),(0,s.jsxs)("p",{className:"text-xs text-muted",children:["Model: ",$.get(e.payload?.model_id)||"—"," \xb7"," ",f(e.created_at)]})]}),s.jsx("p",{className:"text-xs text-muted",children:e.payload?.mode==="batch"?`${e.result?.count??"—"} customers`:`Customer ${e.result?.customer_id??e.payload?.customer_id??"—"}`})]})},e.prediction_id))]})]}),y&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-3xl rounded-2xl border border-panelBorder bg-panel",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-panelBorder px-6 py-4",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-xs uppercase text-muted",children:"Prediction"}),s.jsx("h3",{className:"text-lg font-semibold",children:"Create prediction"})]}),s.jsx(u.z,{variant:"ghost",className:"h-9 w-9 p-0",onClick:()=>v(!1),"aria-label":"Close",children:s.jsx(x.Z,{size:16})})]}),(0,s.jsxs)("div",{className:"grid gap-4 p-6 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 md:col-span-2",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Select model"}),s.jsx("p",{className:"mt-1 text-xs text-muted",children:"Choose a trained model."}),s.jsx("div",{className:"mt-3",children:(0,s.jsxs)(l.P,{value:r,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"",children:"Select model"}),(k.data??[]).map(e=>s.jsx("option",{value:e.model_id,children:e.name},e.model_id))]})})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 md:col-span-2",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Prediction type"}),s.jsx("p",{className:"mt-1 text-xs text-muted",children:"Choose a single customer or a full batch."}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap gap-3",children:[s.jsx("button",{type:"button",onClick:()=>w("single"),className:(0,h.cn)("flex-1 rounded-lg border border-panelBorder px-3 py-2 text-left text-sm transition","single"===N?"bg-accentSoft text-text":"bg-panel text-muted hover:bg-panelBorder/50 hover:text-text"),children:"Single prediction"}),s.jsx("button",{type:"button",onClick:()=>w("batch"),className:(0,h.cn)("flex-1 rounded-lg border border-panelBorder px-3 py-2 text-left text-sm transition","batch"===N?"bg-accentSoft text-text":"bg-panel text-muted hover:bg-panelBorder/50 hover:text-text"),children:"Batch prediction"})]})]}),"single"===N?(0,s.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4 md:col-span-2",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Single prediction"}),s.jsx("p",{className:"mt-1 text-xs text-muted",children:"Enter a customer ID to run a prediction."}),(0,s.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-[1fr_auto] md:items-center",children:[s.jsx(c.I,{placeholder:"Customer ID",value:b,onChange:e=>j(e.target.value)}),s.jsx(u.z,{onClick:A,disabled:!b||!r,loading:_,children:"Run single prediction"})]})]}):(0,s.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4 md:col-span-2",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Batch prediction"}),s.jsx("p",{className:"mt-1 text-xs text-muted",children:"Run predictions for all customers in the model dataset."}),s.jsx("div",{className:"mt-3",children:s.jsx(u.z,{onClick:T,disabled:!r,loading:S,children:"Run batch prediction"})})]})]})]})})]})}},33071:(e,t,r)=>{"use strict";r.d(t,{SZ:()=>d,Zb:()=>i,ll:()=>o});var s=r(10326),n=r(77863);function i({className:e,...t}){return s.jsx("div",{className:(0,n.cn)("rounded-xl border border-panelBorder bg-panel p-4",e),...t})}function o({className:e,...t}){return s.jsx("h3",{className:(0,n.cn)("text-lg font-semibold",e),...t})}function d({className:e,...t}){return s.jsx("p",{className:(0,n.cn)("text-sm text-muted",e),...t})}},54432:(e,t,r)=>{"use strict";r.d(t,{I:()=>i});var s=r(10326),n=r(77863);function i({className:e,...t}){return s.jsx("input",{className:(0,n.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text placeholder:text-muted focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",e),...t})}},25517:(e,t,r)=>{"use strict";r.d(t,{h:()=>i});let s=function(){let e=process.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function n(e,t){let{auth:n}=await Promise.resolve().then(r.bind(r,20902)),i=n.currentUser,o=i?await i.getIdToken():null,d=i?.uid,a=await fetch(`${s}${e}`,{headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{},...d?{"X-Tenant-Id":d}:{}},...t});if(!a.ok)throw Error(`API request failed: ${a.status}`);return a.json()}let i={health:()=>n("/health"),predict:e=>n("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>n("/metrics"),segments:()=>n("/segments"),models:()=>n("/models"),modelDetail:e=>n(`/models/${e}`),modelJson:e=>n(`/models/${e}/json`),modelDataset:e=>n(`/models/${e}/dataset`),defaultModel:()=>n("/models/default"),setDefaultModel:e=>n("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>n("/predictions"),predictionDetail:e=>n(`/predictions/${e}`),predictionDownload:e=>n(`/predictions/${e}/download`),predictionCsv:async e=>{let{auth:t}=await Promise.resolve().then(r.bind(r,20902));return fetch(`${s}/predictions/${e}/csv`,{headers:{"Content-Type":"text/csv",...t.currentUser?.uid?{"X-Tenant-Id":t.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,r)=>{let n=new FormData;n.append("tenant_id",e),n.append("file",t),r&&n.append("mapping",JSON.stringify(r));let i=await fetch(`${s}/upload`,{method:"POST",body:n});if(!i.ok)throw Error("Upload failed");return i.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}},33720:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`C:\Data-Science-Project\Customer-Segmentation-Retention-Analysis\frontend\app\(dashboard)\predictions\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,771,496,872,108,332],()=>r(12536));module.exports=s})();