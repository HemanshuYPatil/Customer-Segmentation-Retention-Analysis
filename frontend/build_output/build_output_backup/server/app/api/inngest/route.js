"use strict";(()=>{var e={};e.id=604,e.ids=[604],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},19801:e=>{e.exports=require("os")},74175:e=>{e.exports=require("tty")},21764:e=>{e.exports=require("util")},92761:e=>{e.exports=require("node:async_hooks")},30080:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>Y,patchFetch:()=>Q,requestAsyncStorage:()=>G,routeModule:()=>M,serverHooks:()=>X,staticGenerationAsyncStorage:()=>J});var i={};n.r(i),n.d(i,{GET:()=>z,POST:()=>Z,PUT:()=>V});var r=n(49303),s=n(88716),a=n(60670),o=n(73393),d=n(3371),l=n(28904),c=n(99268),h=n(97490),u=n(7584),p=n(18993),g=n(9212),f=n(35777),y=n(27484);let m=(e,t)=>{if(Object.values(e).includes(t))return t};var v=n(53998),w=n(39038),b=class{timings={};start(e,t){this.timings[e]||(this.timings[e]={description:t??"",timers:[]});let n=this.timings[e].timers.push({start:Date.now()})-1;return()=>{let t=this.timings[e];if(!t)return console.warn(`Timing "${e}" does not exist`);let i=t.timers[n];if(!i)return console.warn(`Timer ${n} for timing "${e}" does not exist`);i.end=Date.now()}}append(e,t){this.timings[e]={description:t,timers:[]}}async wrap(e,t,n){let i=this.start(e,n);try{return await (0,w.qN)(t)}finally{i()}}getHeader(){return Object.entries(this.timings).reduce((e,[t,{description:n,timers:i}])=>{if(!i.some(e=>e.end))return e;let r=i.reduce((e,{start:t,end:n})=>t&&n?e+(n-t):e,0);return[...e,[t,n?`desc="${n}"`:"",r?`dur=${r}`:""].filter(Boolean).join(";")]},[]).join(", ")}};let S=e=>{let t;let n=new Promise(e=>{t=e}),i=e?.interval??3e3,r=e?.value??" ";return new Promise(async(e,s)=>{try{e({stream:new ReadableStream({start(e){let n=new TextEncoder,s=setInterval(()=>{e.enqueue(n.encode(r))},i);t(t=>{clearInterval(s),Promise.resolve(t).then(t=>{e.enqueue(n.encode((0,f.Pz)(t))),e.close()})})}}),finalize:await n})}catch(e){s(e)}})};var _=n(1195),k=n(19156),I=n(19092);function x(e){let t=Error(e);return t.source="ulid",t}let P="0123456789ABCDEFGHJKMNPQRSTVWXYZ",E=P.length,R=function(e){return e||(e=function(e=!1,t){t||(t="undefined"!=typeof window?window:null);let i=t&&(t.crypto||t.msCrypto);if(i)return()=>{let e=new Uint8Array(1);return i.getRandomValues(e),e[0]/255};try{let e=n(84770);return()=>e.randomBytes(1).readUInt8()/255}catch(e){}if(e){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(e){}return()=>Math.random()}throw x("secure crypto unusable, insecure Math.random not allowed")}()),function(t){return isNaN(t)&&(t=Date.now()),function(e,t){let n;if(isNaN(e))throw Error(e+" must be a number");if(e>0xffffffffffff)throw x("cannot encode time greater than 281474976710655");if(e<0)throw x("time must be positive");if(!1===Number.isInteger(Number(e)))throw x("time must be an integer");let i="";for(;t>0;t--)n=e%E,i=P.charAt(n)+i,e=(e-n)/E;return i}(t,10)+function(e,t){let n="";for(;e>0;e--)n=function(e){let t=Math.floor(e()*E);return t===E&&(t=E-1),P.charAt(t)}(t)+n;return n}(16,e)}}();var T=n(91585);let q=T.Ry({status:T.Rx().default(200),skipped:T.O7().optional().default(!1),modified:T.O7().optional().default(!1),error:T.Z_().default("Successfully registered")});var O=class{id;handler;inngestRegisterUrl;frameworkName;signingKey;signingKeyFallback;_mode;fetch;_serveHost;_servePath;logLevel;streaming;rawFns;client;fns={};env=(0,o.gx)();allowExpiredSignatures;_options;skipSignatureValidation;constructor(e){if(this._options=e,Object.hasOwn(e,"eventKey"))throw Error(`${c.Ap} You've passed an Inngest client as the first argument to your serve handler. This is no longer supported in v3; please pass the Inngest client as the \`client\` property of an options object instead. See https://www.inngest.com/docs/sdk/migration`);this.frameworkName=e.frameworkName,this.client=e.client,e.id&&console.warn(`${c.Ap} The \`id\` serve option is deprecated and will be removed in v4`),this.id=e.id||this.client.id,this.handler=e.handler,this.allowExpiredSignatures=!!arguments[0]?.__testingAllowExpiredSignatures,this.rawFns=e.functions?.filter(Boolean)??[],this.rawFns.length!==(e.functions??[]).length&&console.warn("Some functions passed to serve() are undefined and misconfigured.  Please check your imports."),this.fns=this.rawFns.reduce((e,t)=>{let n=t.getConfig({baseUrl:new URL("https://example.com"),appPrefix:this.id}),i=n.reduce((e,{id:n},i)=>({...e,[n]:{fn:t,onFailure:!!i}}),{});return n.forEach(({id:t})=>{if(e[t])throw Error(`Duplicate function ID "${t}"; please change a function's name or provide an explicit ID to avoid conflicts.`)}),{...e,...i}},{}),this.inngestRegisterUrl=new URL("/fn/register",this.apiBaseUrl),this.signingKey=e.signingKey,this.signingKeyFallback=e.signingKeyFallback,this._serveHost=e.serveHost||this.env[c.hZ.InngestServeHost],this._servePath=e.servePath||this.env[c.hZ.InngestServePath],this.skipSignatureValidation=e.skipSignatureValidation||!1;let t="info";this.logLevel=T.Km(h._i).default(t).catch(e=>(this.log("warn",`Unknown log level passed: ${String(e.input)}; defaulting to ${t}`),t)).parse(e.logLevel||this.env[c.hZ.InngestLogLevel]),"debug"===this.logLevel&&I.enable&&"function"==typeof I.enable&&I.enable(`${c.g8}:*`),this.streaming=T.G0([T.Km(["allow","force"]),T.i0(!1)]).default(!1).catch(e=>(this.log("warn",`Unknown streaming option passed: ${String(e.input)}; defaulting to ${String(!1)}`),!1)).parse(e.streaming||this.env[c.hZ.InngestStreaming]),this.fetch=e.fetch?(0,o.wY)(e.fetch):this.client.fetch}get apiBaseUrl(){return this._options.baseUrl||this.env[c.hZ.InngestApiBaseUrl]||this.env[c.hZ.InngestBaseUrl]||this.client.apiBaseUrl||c.Bh}get eventApiBaseUrl(){return this._options.baseUrl||this.env[c.hZ.InngestEventApiBaseUrl]||this.env[c.hZ.InngestBaseUrl]||this.client.eventBaseUrl||c.xk}get serveHost(){return this._serveHost||this.env[c.hZ.InngestServeHost]}get servePath(){return this._servePath||this.env[c.hZ.InngestServePath]}get hashedEventKey(){if(this.client.eventKey&&this.client.eventKey!==c.V5)return(0,f.h2)(this.client.eventKey)}get hashedSigningKey(){if(this.signingKey)return(0,f.sQ)(this.signingKey)}get hashedSigningKeyFallback(){if(this.signingKeyFallback)return(0,f.sQ)(this.signingKeyFallback)}async shouldStream(e){return await e.queryStringWithDefaults("testing for probe",c.ad.Probe)===void 0&&!!e.transformStreamingResponse&&("force"===this.streaming||"allow"===this.streaming&&(0,o.Ih)(this.frameworkName,this.env))}async isInngestReq(e){let t="checking if this is an Inngest request",[n,i]=await Promise.all([e.headers(t,c.cW.InngestRunId),e.headers(t,c.cW.Signature)]);return!!(n&&"string"==typeof i)}async initRequest(...e){let t=new b,n=await this.getActions(t,...e),[i,r]=await Promise.all([n.env?.("starting to handle request"),n.headers("checking expected server kind",c.cW.InngestServerKind)]);this.env={...(0,o.gx)(),...i};let s=Promise.all(c.Ng.map(async e=>({header:e,value:await n.headers(`fetching ${e} for forwarding`,e)}))).then(e=>e.reduce((e,{header:t,value:n})=>(n&&(e[t]=n),e),{})),a=async()=>({...(0,o.vS)({env:this.env,framework:this.frameworkName,client:this.client,expectedServerKind:r||void 0,extras:{"Server-Timing":t.getHeader()}}),...await s}),d=(0,o.iJ)({env:this.env,client:this.client});if(d.isExplicit)this._mode=d;else{let e=await n.isProduction?.("starting to handle request");"boolean"==typeof e?this._mode=new o.AR({type:e?"cloud":"dev",isExplicit:!1}):this._mode=d}return this.upsertKeysFromEnv(),{timer:t,actions:n,getHeaders:a}}createSyncHandler(){return e=>this.wrapHandler(async(...t)=>{let n=await this.initRequest(...t),i=new _.g(this.client,{id:this._options.syncOptions?.functionId??"",retries:this._options.syncOptions?.retries??c.YK},()=>e(...t));return await this.isInngestReq(n.actions)?this.handleAsyncRequest({...n,forceExecution:!0,args:t,fns:[i]}):this.handleSyncRequest({...n,args:t,asyncMode:this._options.syncOptions?.asyncResponse??h.N7.Redirect,fn:i})})}createHandler(){return this.wrapHandler(async(...e)=>this.handleAsyncRequest({...await this.initRequest(...e),args:e}))}async createHttpEvent(e,t){let n="creating sync event",i=e.headers(n,c.cW.ContentType).then(e=>e??""),r=e.headers(n,c.cW.ForwardedFor).then(t=>t||e.headers(n,c.cW.RealIp).then(e=>e??"")),s=e.method(n),a=e.url(n).then(e=>this.reqUrl(e)),o=a.then(e=>`${e.protocol}//${e.host}`),d=a.then(e=>e.pathname),l=a.then(e=>e.searchParams.toString()),h=e.textBody(n).then(e=>"string"==typeof e?e:(0,f.Pz)(e)),[u,p,g,y,m,v,w]=await Promise.all([i,o,r,s,d,l,h]);return{name:"http/run.started",data:{content_type:u,domain:p,ip:g,method:y,path:m,query_params:v,body:w,fn:t.id()}}}async handleSyncRequest({timer:e,actions:t,fn:n,asyncMode:i,args:r}){if(!t.experimentalTransformSyncResponse)throw Error("This platform does not support synchronous Inngest function executions.");if(await (0,d.A)())throw Error("We already seem to be in the context of an Inngest execution, but didn't expect to be. Did you already wrap this handler?");let s=R(),a=await this.createHttpEvent(t,n),o=u.I,l=await n.createExecution({version:o,partialOptions:{client:this.client,data:{runId:s,event:a,attempt:0,events:[a],maxAttempts:n.opts.retries??c.YK},runId:s,headers:{},reqArgs:r,stepCompletionOrder:[],stepState:{},disableImmediateExecution:!1,isFailureHandler:!1,timer:e,createResponse:e=>t.experimentalTransformSyncResponse("creating sync execution",e).then(e=>({...e,version:o})),stepMode:h.kf.Sync}}).start(),p={"step-not-found":()=>{throw Error("We should not get the result 'step-not-found' when checkpointing. This is a bug in the `inngest` SDK")},"steps-found":()=>{throw Error("We should not get the result 'steps-found' when checkpointing. This is a bug in the `inngest` SDK")},"step-ran":()=>{throw Error("We should not get the result 'step-ran' when checkpointing. This is a bug in the `inngest` SDK")},"function-rejected":()=>{throw Error("We should not get the result 'function-rejected' when checkpointing. This is a bug in the `inngest` SDK")},"function-resolved":({data:e})=>e,"change-mode":async({token:e})=>{switch(i){case h.N7.Redirect:return t.transformResponse("creating sync->async redirect response",{status:302,headers:{[c.cW.Location]:await this.client.inngestApi.getTargetUrl(`/v1/http/runs/${s}/output?token=${e}`).then(e=>e.toString())},version:o,body:""});case h.N7.Token:return t.transformResponse("creating sync->async token response",{status:200,headers:{},version:o,body:(0,f.Pz)({run_id:s,token:e})})}throw Error("Not implemented: change-mode")}}[l.type];if(!p)throw Error(`No handler for execution result type: ${l.type}. This is a bug in the \`inngest\` SDK`);return p(l)}async handleAsyncRequest({timer:e,actions:t,args:n,getHeaders:i,forceExecution:r,fns:s}){if(r&&!t.experimentalTransformSyncResponse)throw Error("This platform does not support async executions in Inngest for APIs.");let a=t.method("starting to handle request"),o=await t.headers("checking signature for request",c.cW.ContentLength).then(e=>{if(e)return Number.parseInt(e,10)}),[d,l,h]=await Promise.all([t.headers("checking signature for request",c.cW.Signature).then(e=>e??void 0),a,a.then(e=>("POST"===e||"PUT"===e)&&o?t.body(`checking body for request signing as method is ${e}`):"")]),g=this.validateSignature(d,h),y=e.wrap("action",()=>this.handleAction({actions:t,timer:e,getHeaders:i,reqArgs:n,signatureValidation:g,body:h,method:l,forceExecution:!!r,fns:s})),m=async e=>{let t;let n={...await i(),...e.headers,...null===e.version?{}:{[c.cW.RequestVersion]:(e.version??u.I).toString()}};try{t=await g.then(t=>{if(t.success&&t.keyUsed)return this.getResponseSignature(t.keyUsed,e.body)})}catch(t){return{...e,headers:n,body:(0,f.Pz)((0,p.Xy)(t)),status:500}}return t&&(n[c.cW.Signature]=t),{...e,headers:n}};if(await this.shouldStream(t)&&await t.method("starting streaming response")==="POST"){let{stream:n,finalize:r}=await S();return y.then(e=>r(m(e))),e.wrap("res",async()=>t.transformStreamingResponse?.("starting streaming response",{status:201,headers:await i(),body:n,version:null}))}return e.wrap("res",async()=>y.then(m).then(e=>t.transformResponse("sending back response",e)))}async getActions(e,...t){let n=t[t.length-1],i="object"==typeof n&&null!==n&&"actionOverrides"in n&&"object"==typeof n.actionOverrides&&null!==n.actionOverrides?n.actionOverrides:{},r={...Object.entries({...await e.wrap("handler",()=>this.handler(...t)).catch((0,p.LB)("Serve handler failed to run")),...i}).reduce((e,[t,n])=>"function"!=typeof n?e:{...e,[t]:(e,...i)=>{let r=[`Failed calling \`${t}\` from serve handler`,e].filter(Boolean).join(" when ");return(0,w.qN)(()=>n(...i)).catch((0,p.LB)(r)).catch(e=>{throw this.log("error",e),e})}},{}),queryStringWithDefaults:async(e,t)=>{let n=await r.url(e);return await r.queryString?.(e,t,n)||n.searchParams.get(t)||void 0},...i};return r}wrapHandler(e){return Object.defineProperties(e,{name:{value:"InngestHandler"},length:{value:this.handler.length}}),e}get mode(){return this._mode}set mode(e){this._mode=e,e&&(this.client.mode=e)}async handleAction({actions:e,timer:t,getHeaders:n,reqArgs:i,signatureValidation:r,body:s,method:a,forceExecution:d,fns:l}){let y=void 0===s,v=s;try{let s=await e.url("starting to handle request");if("POST"===a||d){let s,a,o;if(!d&&y)return this.log("error","Missing body when executing, possibly due to missing request body middleware"),{status:500,headers:{"Content-Type":"application/json"},body:(0,f.Pz)((0,p.Xy)(Error("Missing request body when executing, possibly due to missing request body middleware"))),version:void 0};let w=await r;if(!w.success)return{status:401,headers:{"Content-Type":"application/json"},body:(0,f.Pz)((0,p.Xy)(w.err)),version:void 0};if(d)s=l?.length&&l[0]?{fn:l[0],onFailure:!1}:Object.values(this.fns)[0],a=s?.fn.id(),o="step",v={event:{},events:[],steps:{},version:u.I,sdkDecided:!0,ctx:{attempt:0,disable_immediate_execution:!1,use_api:!0,max_attempts:3,run_id:await e.headers("getting run ID for forced execution",c.cW.InngestRunId),stack:{stack:[],current:0}}};else{let t=await e.queryStringWithDefaults("testing for probe",c.ad.Probe);if(t){let e=m(c.lD,t);if(!e)return{status:400,headers:{"Content-Type":"application/json"},body:(0,f.Pz)((0,p.Xy)(Error(`Unknown probe "${t}"`))),version:void 0};return({[c.lD.Trust]:()=>({status:200,headers:{"Content-Type":"application/json"},body:"",version:void 0})})[e]()}if(!(a=await e.queryStringWithDefaults("processing run request",c.ad.FnId)))throw Error("No function ID found in async request");s=this.fns[a],o=await e.queryStringWithDefaults("processing run request",c.ad.StepId)||null}if(void 0===a||!s)throw Error("No function ID found in request");let{version:b,result:S}=this.runStep({functionId:a,data:v,stepId:o,timer:t,reqArgs:i,headers:await n(),fn:s,forceExecution:d,actions:e}),_=await S,I=e=>(e.data=(0,g.gL)(e.data),e),x={"function-rejected":e=>({status:e.retriable?500:400,headers:{"Content-Type":"application/json",[c.cW.NoRetry]:e.retriable?"false":"true",..."string"==typeof e.retriable?{[c.cW.RetryAfter]:e.retriable}:{}},body:(0,f.Pz)((0,g.gL)(e.error)),version:b}),"function-resolved":e=>{if(d){let t={id:k.VB.hashId("complete"),op:h.CU.RunComplete,data:(0,g.gL)(e.data)};return{status:206,headers:{"Content-Type":"application/json"},body:(0,f.Pz)(t),version:b}}return{status:200,headers:{"Content-Type":"application/json"},body:(0,f.Pz)((0,g.gL)(e.data)),version:b}},"step-not-found":e=>({status:500,headers:{"Content-Type":"application/json",[c.cW.NoRetry]:"false"},body:(0,f.Pz)({error:`Could not find step "${e.step.displayName||e.step.id}" to run; timed out`}),version:b}),"step-ran":e=>{let t=I(e.step);return{status:206,headers:{"Content-Type":"application/json",...void 0!==e.retriable?{[c.cW.NoRetry]:e.retriable?"false":"true",..."string"==typeof e.retriable?{[c.cW.RetryAfter]:e.retriable}:{}}:{}},body:(0,f.Pz)([t]),version:b}},"steps-found":e=>{let t=e.steps.map(I);return{status:206,headers:{"Content-Type":"application/json"},body:(0,f.Pz)(t),version:b}},"change-mode":e=>({status:500,headers:{"Content-Type":"application/json",[c.cW.NoRetry]:"true"},body:(0,f.Pz)({error:`We wanted to change mode to "${e.to}", but this is not supported within the InngestCommHandler. This is a bug in the Inngest SDK.`}),version:b})}[_.type];try{return await x(_)}catch(e){throw this.log("error","Error handling execution result",e),e}}let w=(await n())[c.cW.Environment]??null;if("GET"===a)return{status:200,body:(0,f.Pz)(await this.introspectionBody({actions:e,env:w,signatureValidation:r,url:s})),headers:{"Content-Type":"application/json"},version:void 0};if("PUT"===a){let[t,i]=await Promise.all([e.queryStringWithDefaults("processing deployment request",c.ad.DeployId).then(e=>"undefined"===e?void 0:e),Promise.resolve((0,o.AE)(this.env[c.hZ.InngestAllowInBandSync])).then(t=>void 0===t||t?e.headers("processing deployment request",c.cW.InngestSyncKind):c.q_.OutOfBand).then(e=>e===c.q_.InBand)]);if(i){if(y)return this.log("error","Missing body when syncing, possibly due to missing request body middleware"),{status:500,headers:{"Content-Type":"application/json"},body:(0,f.Pz)((0,p.Xy)(Error("Missing request body when syncing, possibly due to missing request body middleware"))),version:void 0};if(!(await r).success)return{status:401,body:(0,f.Pz)({code:"sig_verification_failed"}),headers:{"Content-Type":"application/json"},version:void 0};let n=h.ej.safeParse(v);if(!n.success)return{status:400,body:(0,f.Pz)({code:"invalid_request",message:n.error.message}),headers:{"Content-Type":"application/json"},version:void 0};return s=this.reqUrl(new URL(n.data.url)),{status:200,body:(0,f.Pz)(await this.inBandRegisterBody({actions:e,deployId:t,env:w,signatureValidation:r,url:s})),headers:{"Content-Type":"application/json",[c.cW.InngestSyncKind]:c.q_.InBand},version:void 0}}let{status:a,message:d,modified:l}=await this.register(this.reqUrl(s),t,n);return{status:a,body:(0,f.Pz)({message:d,modified:l}),headers:{"Content-Type":"application/json",[c.cW.InngestSyncKind]:c.q_.OutOfBand},version:void 0}}}catch(e){return{status:500,body:(0,f.Pz)({type:"internal",...(0,p.Xy)(e)}),headers:{"Content-Type":"application/json"},version:void 0}}return{status:405,body:JSON.stringify({message:"No action found; request was likely not POST, PUT, or GET",mode:this._mode}),headers:{},version:void 0}}runStep({actions:e,functionId:t,stepId:n,data:i,timer:r,reqArgs:s,headers:a,fn:o,forceExecution:d}){if(!o)throw Error(`Could not find function with ID "${t}"`);let l=(0,g.lz)(i),{version:u,sdkDecided:p}=l;u===c.N7.V1&&p&&o.fn.shouldOptimizeParallelism?.()&&(u=c.N7.V2);let f=(0,w.qN)(async()=>{let t=await (0,g.si)({data:l,api:this.client.inngestApi,version:u});if(!t.ok)throw Error(t.error);let i=d&&e.experimentalTransformSyncResponse?t=>e.experimentalTransformSyncResponse("created sync->async response",t).then(e=>({...e,version:u})):void 0,p=await ({[c.N7.V0]:({event:e,events:t,steps:d,ctx:l,version:c})=>{let u=Object.entries(d??{}).reduce((e,[t,n])=>({...e,[t]:{id:t,data:n}}),{});return{version:c,partialOptions:{client:this.client,runId:l?.run_id||"",stepMode:h.kf.Async,data:{event:e,events:t,runId:l?.run_id||"",attempt:l?.attempt??0},stepState:u,requestedRunStep:"step"===n?void 0:n||void 0,timer:r,isFailureHandler:o.onFailure,stepCompletionOrder:l?.stack?.stack??[],reqArgs:s,headers:a,createResponse:i}}},[c.N7.V1]:({event:e,events:t,steps:d,ctx:l,version:c})=>{let u=Object.entries(d??{}).reduce((e,[t,n])=>({...e,[t]:"data"===n.type?{id:t,data:n.data}:"input"===n.type?{id:t,input:n.input}:{id:t,error:n.error}}),{}),p="step"===n?void 0:n||void 0,g=o.fn.shouldAsyncCheckpoint(p,l?.fn_id,!!l?.disable_immediate_execution);return{version:c,partialOptions:{client:this.client,runId:l?.run_id||"",stepMode:g?h.kf.AsyncCheckpointing:h.kf.Async,checkpointingConfig:g,data:{event:e,events:t,runId:l?.run_id||"",attempt:l?.attempt??0,maxAttempts:l?.max_attempts},internalFnId:l?.fn_id,queueItemId:l?.qi_id,stepState:u,requestedRunStep:p,timer:r,isFailureHandler:o.onFailure,disableImmediateExecution:l?.disable_immediate_execution,stepCompletionOrder:l?.stack?.stack??[],reqArgs:s,headers:a,createResponse:i}}},[c.N7.V2]:({event:e,events:t,steps:d,ctx:l,version:c})=>{let u=Object.entries(d??{}).reduce((e,[t,n])=>({...e,[t]:"data"===n.type?{id:t,data:n.data}:"input"===n.type?{id:t,input:n.input}:{id:t,error:n.error}}),{}),p="step"===n?void 0:n||void 0,g=o.fn.shouldAsyncCheckpoint(p,l?.fn_id,!!l?.disable_immediate_execution);return{version:c,partialOptions:{client:this.client,runId:l?.run_id||"",stepMode:g?h.kf.AsyncCheckpointing:h.kf.Async,checkpointingConfig:g,data:{event:e,events:t,runId:l?.run_id||"",attempt:l?.attempt??0,maxAttempts:l?.max_attempts},internalFnId:l?.fn_id,queueItemId:l?.qi_id,stepState:u,requestedRunStep:p,timer:r,isFailureHandler:o.onFailure,disableImmediateExecution:l?.disable_immediate_execution,stepCompletionOrder:l?.stack?.stack??[],reqArgs:s,headers:a,createResponse:i}}}})[u](t.value);return o.fn.createExecution(p).start()});return{version:u,result:f}}configs(e){let t=Object.values(this.rawFns).reduce((t,n)=>[...t,...n.getConfig({baseUrl:e,appPrefix:this.id})],[]);for(let e of t){let t=h.eb.safeParse(e);if(!t.success){let n=t.error.errors.map(e=>e.message).join("; ");this.log("warn",`Config invalid for function "${e.id}" : ${n}`)}}return t}reqUrl(e){let t=new URL(e),n=this.serveHost||this.env[c.hZ.InngestServeHost],i=this.servePath||this.env[c.hZ.InngestServePath];return i&&(t.pathname=i),n&&(t=new URL(t.pathname+t.search,n)),t}registerBody({url:e,deployId:t}){return{url:e.href,deployType:"ping",framework:this.frameworkName,appName:this.id,functions:this.configs(e),sdk:`js:v${l.i}`,v:"0.1",deployId:t||void 0,capabilities:{trust_probe:"v1",connect:"v1"},appVersion:this.client.appVersion}}async inBandRegisterBody({actions:e,deployId:t,env:n,signatureValidation:i,url:r}){let s=this.registerBody({deployId:t,url:r}),a=await this.introspectionBody({actions:e,env:n,signatureValidation:i,url:r}),d={app_id:this.id,appVersion:this.client.appVersion,capabilities:s.capabilities,env:n,framework:s.framework,functions:s.functions,inspection:a,platform:(0,o.y8)({...(0,o.gx)(),...this.env}),sdk_author:"inngest",sdk_language:"",sdk_version:"",sdk:s.sdk,url:s.url};return"authentication_succeeded"in a&&a.authentication_succeeded&&(d.sdk_language=a.sdk_language,d.sdk_version=a.sdk_version),d}async introspectionBody({actions:e,env:t,signatureValidation:n,url:i}){let r=this.registerBody({url:this.reqUrl(i),deployId:null});if(!this._mode)throw Error("No mode set; cannot introspect without mode");let s={extra:{is_mode_explicit:this._mode.isExplicit},has_event_key:this.client.eventKeySet(),has_signing_key:!!this.signingKey,function_count:r.functions.length,mode:this._mode.type,schema_version:"2024-05-24"};if("cloud"===this._mode.type)try{if(!(await n).success)throw Error("Signature validation failed");s={...s,authentication_succeeded:!0,api_origin:this.apiBaseUrl,app_id:this.id,capabilities:{trust_probe:"v1",connect:"v1"},env:t,event_api_origin:this.eventApiBaseUrl,event_key_hash:this.hashedEventKey??null,extra:{...s.extra,is_streaming:await this.shouldStream(e)},framework:this.frameworkName,sdk_language:"js",sdk_version:l.i,serve_origin:this.serveHost??null,serve_path:this.servePath??null,signing_key_fallback_hash:this.hashedSigningKeyFallback??null,signing_key_hash:this.hashedSigningKey??null}}catch{s={...s}}return s}async register(e,t,n){let i,r,s,a,d;let l=this.registerBody({url:e,deployId:t}),h=new URL(this.inngestRegisterUrl.href);if(this._mode&&this._mode.isInferred&&this._mode.isDev){let e=(0,o.U5)(this.env);await (0,y.D)(e,this.fetch)&&(h=(0,y.W)(e,"/fn/register"))}else this._mode?.explicitDevUrl&&(h=(0,y.W)(this._mode.explicitDevUrl.href,"/fn/register"));t&&h.searchParams.set(c.ad.DeployId,t);try{i=await (0,v.c)({authToken:this.hashedSigningKey,authTokenFallback:this.hashedSigningKeyFallback,fetch:this.fetch,url:h.href,options:{method:"POST",body:(0,f.Pz)(l),headers:{...await n(),[c.cW.InngestSyncKind]:c.q_.OutOfBand},redirect:"follow"}})}catch(e){return this.log("error",e),{status:500,message:`Failed to register${e instanceof Error?`; ${e.message}`:""}`,modified:!1}}let u=await i.text(),p={};try{p=JSON.parse(u)}catch(t){this.log("warn","Couldn't unpack register response:",t);let e="Failed to register";return t instanceof Error&&(e+=`; ${t.message}`),{status:500,message:e+=`; status code: ${i.status}`,modified:!1}}try{({status:r,error:s,skipped:a,modified:d}=q.parse(p))}catch(t){this.log("warn","Invalid register response schema:",t);let e="Failed to register";return t instanceof Error&&(e+=`; ${t.message}`),{status:500,message:e+=`; status code: ${i.status}`,modified:!1}}return a||this.log("debug","registered inngest functions:",i.status,i.statusText,p),{status:r,message:s,modified:d}}upsertKeysFromEnv(){this.env[c.hZ.InngestSigningKey]&&(this.signingKey||(this.signingKey=String(this.env[c.hZ.InngestSigningKey])),this.client.inngestApi.setSigningKey(this.signingKey)),this.env[c.hZ.InngestSigningKeyFallback]&&(this.signingKeyFallback||(this.signingKeyFallback=String(this.env[c.hZ.InngestSigningKeyFallback])),this.client.inngestApi.setSigningKeyFallback(this.signingKeyFallback)),!this.client.eventKeySet()&&this.env[c.hZ.InngestEventKey]&&this.client.setEventKey(String(this.env[c.hZ.InngestEventKey])),this.env[c.hZ.InngestDevServerUrl]&&this.log("warn",`Use of ${c.hZ.InngestDevServerUrl} has been deprecated in v3; please use ${c.hZ.InngestBaseUrl} instead. See https://www.inngest.com/docs/sdk/migration`)}async validateSignature(e,t){try{if(this.skipSignatureValidation||this._mode&&!this._mode.isCloud)return{success:!0,keyUsed:""};if(!this.signingKey)throw Error(`No signing key found in client options or ${c.hZ.InngestSigningKey} env var. Find your keys at https://app.inngest.com/secrets`);if(!e)throw Error(`No ${c.cW.Signature} provided`);return{success:!0,keyUsed:new K(e).verifySignature({body:t,allowExpiredSignatures:this.allowExpiredSignatures,signingKey:this.signingKey,signingKeyFallback:this.signingKeyFallback})}}catch(e){return{success:!1,err:e}}}getResponseSignature(e,t){let n=Date.now();return`t=${n}&s=${(0,v.P)(t,e,n.toString())}`}log(e,...t){let n=["debug","info","warn","error","fatal","silent"],i=n.indexOf(this.logLevel);if(n.indexOf(e)>=i){let n=console.log;Object.hasOwn(console,e)&&(n=console[e]),n(`${c.Ap} ${e} -`,...t)}}},K=class{timestamp;signature;constructor(e){let t=new URLSearchParams(e);if(this.timestamp=t.get("t")||"",this.signature=t.get("s")||"",!this.timestamp||!this.signature)throw Error(`Invalid ${c.cW.Signature} provided`)}hasExpired(e){return!e&&Date.now()-new Date(1e3*Number.parseInt(this.timestamp)).valueOf()>3e5}#e({body:e,signingKey:t,allowExpiredSignatures:n}){if(this.hasExpired(n))throw Error("Signature has expired");if((0,v.P)(e,t,this.timestamp)!==this.signature)throw Error("Invalid signature")}verifySignature({body:e,signingKey:t,signingKeyFallback:n,allowExpiredSignatures:i}){try{return this.#e({body:e,signingKey:t,allowExpiredSignatures:i}),t}catch(t){if(!n)throw t;return this.#e({body:e,signingKey:n,allowExpiredSignatures:i}),n}}};let j=e=>"object"==typeof e&&null!==e,U=e=>"function"==typeof e,A=e=>j(e)&&U(e.setHeader)&&U(e.status)&&U(e.send);async function $(e){let t=[],n=e.getReader();for(;;){let{done:e,value:i}=await n.read();if(e)break;t.push(i)}return JSON.parse(Buffer.concat(t).toString("utf8"))}var N=n(87070),C=n(76482),B=n(82495);let F=C.$.createFunction({id:"train-model"},{event:"model.train.requested"},async({event:e})=>{let t=(0,B.b)(),n=await fetch(`${t}/train`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.data)});if(!n.ok){let e=await n.text();throw Error(`Train request failed: ${e}`)}return await n.json()}),D=C.$.createFunction({id:"predict-single"},{event:"model.predict.single"},async({event:e})=>{let t=(0,B.b)(),n=await fetch(`${t}/predict_job`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.data,mode:"single"})});if(!n.ok){let e=await n.text();throw Error(`Single prediction failed: ${e}`)}return await n.json()}),W=C.$.createFunction({id:"predict-batch"},{event:"model.predict.batch"},async({event:e})=>{let t=(0,B.b)(),n=await fetch(`${t}/predict_job`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.data,mode:"batch"})});if(!n.ok){let e=await n.text();throw Error(`Batch prediction failed: ${e}`)}return await n.json()}),H=C.$.createFunction({id:"send-email"},{event:"email.send"},async({event:e})=>{let t=process.env.BREVO_API_URL??"https://api.brevo.com/v3/smtp/email",n=process.env.BREVO_API_KEY,i=process.env.BREVO_SENDER_EMAIL,r=process.env.BREVO_SENDER_NAME??"Customer Segmentation";if(!n||!i)throw Error("Missing BREVO_API_KEY or BREVO_SENDER_EMAIL");let s={sender:{email:i,name:r},to:[{email:e.data.to_email}],subject:e.data.subject,htmlContent:e.data.html,textContent:e.data.text};e.data?.metadata&&Object.keys(e.data.metadata).length>0&&(s.params=e.data.metadata);let a=await fetch(t,{method:"POST",headers:{accept:"application/json","api-key":n,"content-type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.text();throw Error(`Brevo send failed: ${e}`)}return{status:"sent"}}),L=(e=>{let t=new O({frameworkName:"nextjs",...e,handler:(t,...n)=>{let[i,r]=n,s=e=>{let t="function"==typeof i.headers.get?i.headers.get(e):i.headers[e];return Array.isArray(t)?t[0]:t};return{body:async()=>"function"==typeof i.json?await i.json():i.body instanceof ReadableStream?await $(i.body):i.body,headers:s,method:()=>t||i.method||"",isProduction:()=>{try{return!0}catch(e){}},queryString:(e,t)=>{let n=i.query?.[e]||t.searchParams.get(e);return Array.isArray(n)?n[0]:n},url:()=>{let t;try{t=new URL(i.url)}catch{}if(t){let n=e.serveHost||s("host");if(n){let e=new URL(n.includes("://")?n:`${t.protocol}//${n}`);t.protocol=e.protocol,t.host=e.host,t.port=e.port,t.username=e.username,t.password=e.password}return t}let n=e.serveHost||s("host")||"";return new URL(i.url,`https://${n}`)},transformResponse:({body:e,headers:t,status:n})=>{if(A(r)){for(let[e,n]of Object.entries(t))r.setHeader(e,n);r.status(n),r.send(e);return}return new((0,o.ck)())(e,{status:n,headers:t})},transformStreamingResponse:({body:e,headers:t,status:n})=>new Response(e,{status:n,headers:t})}}}).createHandler(),n=t.bind(null,void 0);return Object.defineProperty(n,"length",{value:1}),Object.defineProperties(n,{GET:{value:t.bind(null,"GET")},POST:{value:t.bind(null,"POST")},PUT:{value:t.bind(null,"PUT")}})})({client:C.$,functions:[F,D,W,H]}),z=L.GET,Z=L.POST;async function V(e,t){let n=e.clone(),i=await n.text();return i?L.PUT(new N.NextRequest(e.url,{method:"PUT",headers:e.headers,body:i}),t):new Response(null,{status:200})}let M=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/inngest/route",pathname:"/api/inngest",filename:"route",bundlePath:"app/api/inngest/route"},resolvedPagePath:"C:\\Data-Science-Project\\Customer-Segmentation-Retention-Analysis\\frontend\\app\\api\\inngest\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:G,staticGenerationAsyncStorage:J,serverHooks:X}=M,Y="/api/inngest/route";function Q(){return(0,a.patchFetch)({serverHooks:X,staticGenerationAsyncStorage:J})}},76482:(e,t,n)=>{n.d(t,{$:()=>i});let i=new(n(46932)).K({id:"csr-frontend"})},82495:(e,t,n)=>{n.d(t,{b:()=>i});function i(){let e=process.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[276,205],()=>n(30080));module.exports=i})();