(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34],{97423:function(e,t,n){Promise.resolve().then(n.bind(n,67759))},67759:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(57437),o=n(2265),a=n(99376),s=n(66070),i=n(95186),c=n(62869),u=n(15883),l=n(73578),d=n(53647),f=n(35974);function m(){let e=(0,a.useParams)(),t=null==e?void 0:e.id,[n,m]=(0,o.useState)(""),[p,h]=(0,o.useState)("churn"),[x,b]=(0,o.useState)("desc"),[g,v]=(0,o.useState)([]),[j,y]=(0,o.useState)([]),[w,N]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{if(!t)return;N(!0);let e=await u.h.predictionCsv(t),n=function(e){let t=e.split(/\r?\n/).filter(Boolean);if(0===t.length)return{headers:[],rows:[]};let n=t[0].split(",").map(e=>e.replace(/^"|"$/g,"")),r=t.slice(1).map(e=>{let t=e.split(",").map(e=>e.replace(/^"|"$/g,"")),r={};return n.forEach((e,n)=>{r[e]=t[n]}),r});return{headers:n,rows:r}}(await e.text());y(n.headers),v(n.rows),N(!1)})()},[t]);let S=(0,o.useMemo)(()=>[...n?g.filter(e=>{var t;return String(null!==(t=e.CustomerID)&&void 0!==t?t:e.customer_id).toLowerCase().includes(n.toLowerCase())}):g].sort((e,t)=>{var n,r,o,a,s,i;let c="customer"===p?String(null!==(n=e.CustomerID)&&void 0!==n?n:e.customer_id):"ltv"===p?Number(null!==(r=e.ltv_estimate)&&void 0!==r?r:0):Number(null!==(o=e.churn_probability)&&void 0!==o?o:0),u="customer"===p?String(null!==(a=t.CustomerID)&&void 0!==a?a:t.customer_id):"ltv"===p?Number(null!==(s=t.ltv_estimate)&&void 0!==s?s:0):Number(null!==(i=t.churn_probability)&&void 0!==i?i:0);return c<u?"asc"===x?-1:1:c>u?"asc"===x?1:-1:0}),[g,n,p,x]),P=g.length;return(0,r.jsxs)(s.Zb,{children:[(0,r.jsx)(s.ll,{children:"Batch Results"}),(0,r.jsxs)(s.SZ,{children:["Showing ",P," customers. Use filters or download the full CSV."]}),(0,r.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[(0,r.jsx)(i.I,{placeholder:"Filter by customer ID",value:n,onChange:e=>m(e.target.value),className:"max-w-xs"}),(0,r.jsx)(c.z,{variant:"secondary",onClick:async()=>{let e=await u.h.predictionDownload(t);window.open(e.url,"_blank")},children:"Download full CSV"}),(0,r.jsxs)("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[(0,r.jsxs)(d.P,{value:p,onChange:e=>h(e.target.value),children:[(0,r.jsx)("option",{value:"churn",children:"Sort by churn"}),(0,r.jsx)("option",{value:"ltv",children:"Sort by LTV"}),(0,r.jsx)("option",{value:"customer",children:"Sort by customer"})]}),(0,r.jsxs)(d.P,{value:x,onChange:e=>b(e.target.value),children:[(0,r.jsx)("option",{value:"desc",children:"Descending"}),(0,r.jsx)("option",{value:"asc",children:"Ascending"})]})]})]}),(0,r.jsx)("div",{className:"mt-4 rounded-xl border border-panelBorder bg-background",children:w?(0,r.jsx)("div",{className:"p-4 text-sm text-muted",children:"Loading full results..."}):(0,r.jsxs)(l.iA,{children:[(0,r.jsx)(l.Et,{children:(0,r.jsxs)(l.TR,{children:[(0,r.jsx)(l.TH,{children:"Risk"}),j.map(e=>(0,r.jsx)(l.TH,{children:e},e))]})}),(0,r.jsx)(l.XP,{children:S.map((e,t)=>{var n,o,a;let s=Number(null!==(n=e.churn_probability)&&void 0!==n?n:0),i=Number(null!==(o=e.ltv_estimate)&&void 0!==o?o:0),c=s>=.7?{label:"High Risk",tone:"danger"}:s>=.4?{label:"At Risk",tone:"warning"}:i>=1e3&&s<.3?{label:"Loyal",tone:"success"}:{label:"Stable",tone:"neutral"};return(0,r.jsxs)(l.TR,{children:[(0,r.jsx)(l.TD,{children:(0,r.jsx)(f.C,{tone:c.tone,children:c.label})}),j.map(n=>(0,r.jsx)(l.TD,{children:e[n]},"".concat(n,"-").concat(t)))]},"".concat(null!==(a=e.CustomerID)&&void 0!==a?a:e.customer_id,"-").concat(t))})})]})})]})}},35974:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});var r=n(57437),o=n(94508);function a(e){let{className:t,tone:n="neutral",...a}=e;return(0,r.jsx)("span",{className:(0,o.cn)("inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium",{success:"bg-success/20 text-success border-success/40",warning:"bg-warn/20 text-warn border-warn/40",danger:"bg-danger/20 text-danger border-danger/40",neutral:"bg-accentSoft text-accent border-accent/40"}[n],t),...a})}},62869:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(57437),o=n(2265),a=n(94508);let s=(0,o.forwardRef)((e,t)=>{let{className:n,variant:o="primary",loading:s=!1,disabled:i,children:c,...u}=e;return(0,r.jsxs)("button",{ref:t,className:(0,a.cn)("inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-accent/60 disabled:opacity-50",{primary:"bg-accent text-white hover:opacity-90 shadow-glow",secondary:"bg-panel border border-panelBorder text-text hover:bg-accentSoft",ghost:"bg-transparent text-text hover:bg-panel",danger:"bg-danger text-white hover:opacity-90"}[o],n),disabled:i||s,"aria-busy":s||void 0,...u,children:[s&&(0,r.jsx)("span",{className:"mr-2 inline-flex h-4 w-4 animate-spin items-center justify-center rounded-full border-2 border-current border-t-transparent"}),c]})});s.displayName="Button"},66070:function(e,t,n){"use strict";n.d(t,{SZ:function(){return i},Zb:function(){return a},ll:function(){return s}});var r=n(57437),o=n(94508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,o.cn)("rounded-xl border border-panelBorder bg-panel p-4",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("h3",{className:(0,o.cn)("text-lg font-semibold",t),...n})}function i(e){let{className:t,...n}=e;return(0,r.jsx)("p",{className:(0,o.cn)("text-sm text-muted",t),...n})}},95186:function(e,t,n){"use strict";n.d(t,{I:function(){return a}});var r=n(57437),o=n(94508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("input",{className:(0,o.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text placeholder:text-muted focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...n})}},53647:function(e,t,n){"use strict";n.d(t,{P:function(){return a}});var r=n(57437),o=n(94508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("select",{className:(0,o.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...n})}},73578:function(e,t,n){"use strict";n.d(t,{Et:function(){return s},TD:function(){return l},TH:function(){return u},TR:function(){return c},XP:function(){return i},iA:function(){return a}});var r=n(57437),o=n(94508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("table",{className:(0,o.cn)("w-full border-collapse text-sm",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("thead",{className:(0,o.cn)("text-left text-xs uppercase text-muted",t),...n})}function i(e){let{className:t,...n}=e;return(0,r.jsx)("tbody",{className:(0,o.cn)("divide-y divide-panelBorder",t),...n})}function c(e){let{className:t,...n}=e;return(0,r.jsx)("tr",{className:(0,o.cn)("hover:bg-panelBorder/40",t),...n})}function u(e){let{className:t,...n}=e;return(0,r.jsx)("th",{className:(0,o.cn)("px-4 py-3 font-semibold",t),...n})}function l(e){let{className:t,...n}=e;return(0,r.jsx)("td",{className:(0,o.cn)("px-4 py-3",t),...n})}},94508:function(e,t,n){"use strict";n.d(t,{cn:function(){return a}});var r=n(61994),o=n(53335);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},15883:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var r=n(40257);let o=function(){let e=r.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function a(e,t){let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293)),a=r.currentUser,s=a?await a.getIdToken():null,i=null==a?void 0:a.uid,c=await fetch("".concat(o).concat(e),{headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},...i?{"X-Tenant-Id":i}:{}},...t});if(!c.ok)throw Error("API request failed: ".concat(c.status));return c.json()}let s={health:()=>a("/health"),predict:e=>a("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>a("/metrics"),segments:()=>a("/segments"),models:()=>a("/models"),modelDetail:e=>a("/models/".concat(e)),modelJson:e=>a("/models/".concat(e,"/json")),modelDataset:e=>a("/models/".concat(e,"/dataset")),defaultModel:()=>a("/models/default"),setDefaultModel:e=>a("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>a("/predictions"),predictionDetail:e=>a("/predictions/".concat(e)),predictionDownload:e=>a("/predictions/".concat(e,"/download")),predictionCsv:async e=>{var t;let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293));return fetch("".concat(o,"/predictions/").concat(e,"/csv"),{headers:{"Content-Type":"text/csv",...(null===(t=r.currentUser)||void 0===t?void 0:t.uid)?{"X-Tenant-Id":r.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,n)=>{let r=new FormData;r.append("tenant_id",e),r.append("file",t),n&&r.append("mapping",JSON.stringify(n));let a=await fetch("".concat(o,"/upload"),{method:"POST",body:r});if(!a.ok)throw Error("Upload failed");return a.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}}},function(e){e.O(0,[432,971,117,744],function(){return e(e.s=97423)}),_N_E=e.O()}]);