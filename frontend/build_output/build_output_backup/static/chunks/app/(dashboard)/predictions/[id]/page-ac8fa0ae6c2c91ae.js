(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{98199:function(e,t,n){Promise.resolve().then(n.bind(n,10216))},10216:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(57437),s=n(11713),a=n(99376),o=n(66070),i=n(15883),d=n(35974);function l(e){return null==e||Number.isNaN(e)?"—":e.toLocaleString()}function c(){var e,t,n,c,u,m;let p=(0,a.useParams)(),h=null==p?void 0:p.id,x=(0,s.a)({queryKey:["prediction",h],queryFn:()=>i.h.predictionDetail(h),enabled:!!h,refetchInterval:5e3}),b=null===(e=x.data)||void 0===e?void 0:e.result,f=Number(null!==(t=null==b?void 0:b.churn_probability)&&void 0!==t?t:0),g=Number(null!==(n=null==b?void 0:b.ltv_estimate)&&void 0!==n?n:0),N=f>=.7?{label:"High Risk",tone:"danger"}:f>=.4?{label:"At Risk",tone:"warning"}:g>=1e3&&f<.3?{label:"Loyal",tone:"success"}:{label:"Stable",tone:"neutral"};return(0,r.jsxs)(o.Zb,{children:[(0,r.jsx)(o.ll,{children:"Single Prediction"}),(0,r.jsx)(o.SZ,{children:"Review the latest prediction output."}),(0,r.jsx)("div",{className:"mt-4 rounded-xl border border-panelBorder bg-background p-4",children:x.isLoading?(0,r.jsx)("p",{className:"text-sm text-muted",children:"Loading prediction..."}):x.isError?(0,r.jsx)("p",{className:"text-sm text-danger",children:"Unable to load prediction."}):b?(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Customer"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:null!==(c=b.customer_id)&&void 0!==c?c:"—"})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Segment"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:l(b.segment)})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Churn probability"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:null==(m=b.churn_probability)||Number.isNaN(m)?"—":"".concat(Math.round(100*m),"%")})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"LTV estimate"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:l(b.ltv_estimate)})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3 md:col-span-2",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Recommended action"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:null!==(u=b.recommended_action)&&void 0!==u?u:"—"})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-panel p-3 md:col-span-2",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Risk"}),(0,r.jsx)("div",{className:"mt-2 flex items-center",children:(0,r.jsx)(d.C,{tone:N.tone,children:N.label})})]})]}):(0,r.jsx)("p",{className:"text-sm text-muted",children:"Prediction not ready yet."})})]})}},35974:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});var r=n(57437),s=n(94508);function a(e){let{className:t,tone:n="neutral",...a}=e;return(0,r.jsx)("span",{className:(0,s.cn)("inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium",{success:"bg-success/20 text-success border-success/40",warning:"bg-warn/20 text-warn border-warn/40",danger:"bg-danger/20 text-danger border-danger/40",neutral:"bg-accentSoft text-accent border-accent/40"}[n],t),...a})}},66070:function(e,t,n){"use strict";n.d(t,{SZ:function(){return i},Zb:function(){return a},ll:function(){return o}});var r=n(57437),s=n(94508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)("rounded-xl border border-panelBorder bg-panel p-4",t),...n})}function o(e){let{className:t,...n}=e;return(0,r.jsx)("h3",{className:(0,s.cn)("text-lg font-semibold",t),...n})}function i(e){let{className:t,...n}=e;return(0,r.jsx)("p",{className:(0,s.cn)("text-sm text-muted",t),...n})}},94508:function(e,t,n){"use strict";n.d(t,{cn:function(){return a}});var r=n(61994),s=n(53335);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},15883:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var r=n(40257);let s=function(){let e=r.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function a(e,t){let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293)),a=r.currentUser,o=a?await a.getIdToken():null,i=null==a?void 0:a.uid,d=await fetch("".concat(s).concat(e),{headers:{"Content-Type":"application/json",...o?{Authorization:"Bearer ".concat(o)}:{},...i?{"X-Tenant-Id":i}:{}},...t});if(!d.ok)throw Error("API request failed: ".concat(d.status));return d.json()}let o={health:()=>a("/health"),predict:e=>a("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>a("/metrics"),segments:()=>a("/segments"),models:()=>a("/models"),modelDetail:e=>a("/models/".concat(e)),modelJson:e=>a("/models/".concat(e,"/json")),modelDataset:e=>a("/models/".concat(e,"/dataset")),defaultModel:()=>a("/models/default"),setDefaultModel:e=>a("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>a("/predictions"),predictionDetail:e=>a("/predictions/".concat(e)),predictionDownload:e=>a("/predictions/".concat(e,"/download")),predictionCsv:async e=>{var t;let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293));return fetch("".concat(s,"/predictions/").concat(e,"/csv"),{headers:{"Content-Type":"text/csv",...(null===(t=r.currentUser)||void 0===t?void 0:t.uid)?{"X-Tenant-Id":r.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,n)=>{let r=new FormData;r.append("tenant_id",e),r.append("file",t),n&&r.append("mapping",JSON.stringify(n));let a=await fetch("".concat(s,"/upload"),{method:"POST",body:r});if(!a.ok)throw Error("Upload failed");return a.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}}},function(e){e.O(0,[432,763,713,971,117,744],function(){return e(e.s=98199)}),_N_E=e.O()}]);