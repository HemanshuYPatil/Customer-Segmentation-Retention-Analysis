(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{97961:function(e,t,n){Promise.resolve().then(n.bind(n,98642))},98642:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var r=n(57437),o=n(11713),i=n(62869),a=n(66070),s=n(15883),l=n(89534),c=n(2265),d=n(73578),u=n(35974),m=n(27648),f=n(10407);function h(e){if(!e)return"--";let t=null;if(e instanceof Date&&(t=e),"number"==typeof e&&(t=new Date(e)),"string"==typeof e){let n=new Date(e);t=Number.isNaN(n.getTime())?null:n}if(e.seconds&&(t=new Date(1e3*e.seconds)),e._seconds&&(t=new Date(1e3*e._seconds)),e.toDate&&(t=e.toDate()),e.toMillis&&(t=new Date(e.toMillis())),!t)return"--";let n=Date.now()-t.getTime();if(n<0)return"just now";let r=Math.floor(n/1e3),o=Math.floor(r/60),i=Math.floor(o/60),a=Math.floor(i/24),s=Math.floor(a/30);return r<60?"".concat(r,"s ago"):o<60?"".concat(o,"m ago"):i<24?"".concat(i,"h ago"):a<30?"".concat(a,"d ago"):s<12?"".concat(s,"mo ago"):"".concat(Math.floor(a/365),"y ago")}function x(e){if(!e)return 0;if(e instanceof Date)return e.getTime();if("number"==typeof e)return e;if("string"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?0:t.getTime()}return e.seconds?1e3*e.seconds:e._seconds?1e3*e._seconds:e.toMillis?e.toMillis():e.toDate?e.toDate().getTime():0}function p(){var e,t,n,p,g,b,j,v;let{push:y}=(0,l.p)(),[w,N]=(0,c.useState)([]),T=(0,c.useRef)(0),D=(0,o.a)({queryKey:["metrics"],queryFn:s.h.metrics,retry:!1,refetchInterval:5e3}),_=(0,o.a)({queryKey:["models"],queryFn:s.h.models,retry:!1,refetchInterval:5e3}),S=null!==(b=null===(e=(0,o.a)({queryKey:["default-model"],queryFn:s.h.defaultModel,retry:!1,refetchInterval:5e3}).data)||void 0===e?void 0:e.model_id)&&void 0!==b?b:"",k=(0,c.useMemo)(()=>{var e;return[...null!==(e=_.data)&&void 0!==e?e:[]].sort((e,t)=>x(t.created_at)-x(e.created_at))},[_.data]),M=w.length+k.length>0;(0,c.useEffect)(()=>{let e=window.localStorage.getItem("pending-models");if(e)try{let t=JSON.parse(e);N(t)}catch(e){window.localStorage.removeItem("pending-models")}},[]),(0,c.useEffect)(()=>{let e=k.length,t=e-T.current;if(t>0&&w.length){let e=w.slice(Math.min(t,w.length));N(e),0===e.length?window.localStorage.removeItem("pending-models"):window.localStorage.setItem("pending-models",JSON.stringify(e))}T.current=e},[k.length,w]);let C=async e=>{await s.h.setDefaultModel(e),y({title:"Default model updated.",tone:"success"})},P=(0,c.useMemo)(()=>k.find(e=>e.model_id===S),[k,S]),E=null!==(j=null==P?void 0:null===(t=P.metrics)||void 0===t?void 0:t.logreg_acc)&&void 0!==j?j:null===(n=D.data)||void 0===n?void 0:n.logreg_acc,O=null!==(v=null==P?void 0:null===(p=P.metrics)||void 0===p?void 0:p.logreg_f1)&&void 0!==v?v:null===(g=D.data)||void 0===g?void 0:g.logreg_f1;return(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.ll,{children:"Model Management"}),(0,r.jsx)(a.SZ,{children:"Review trained models and manage production default."}),(0,r.jsxs)("div",{className:"mt-4 grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-background p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"Accuracy"}),(0,r.jsx)("p",{className:"text-2xl font-semibold",children:"number"==typeof E?"".concat((100*E).toFixed(1),"%"):"--"})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-panelBorder bg-background p-3",children:[(0,r.jsx)("p",{className:"text-xs text-muted",children:"F1 Score"}),(0,r.jsx)("p",{className:"text-2xl font-semibold",children:"number"==typeof O?O.toFixed(2):"--"})]})]}),(0,r.jsx)("div",{className:"mt-5 rounded-xl border border-panelBorder bg-background",children:M?(0,r.jsxs)(d.iA,{children:[(0,r.jsx)(d.Et,{children:(0,r.jsxs)(d.TR,{children:[(0,r.jsx)(d.TH,{children:"Model"}),(0,r.jsx)(d.TH,{children:"Created"}),(0,r.jsx)(d.TH,{children:"Accuracy"}),(0,r.jsx)(d.TH,{children:"F1"}),(0,r.jsx)(d.TH,{children:"Status"}),(0,r.jsx)(d.TH,{children:"Actions"}),(0,r.jsx)(d.TH,{})]})}),(0,r.jsxs)(d.XP,{children:[w.map(e=>(0,r.jsxs)(d.TR,{className:"opacity-70",children:[(0,r.jsx)(d.TD,{className:"font-medium",children:e.name}),(0,r.jsx)(d.TD,{children:h(e.createdAt)}),(0,r.jsx)(d.TD,{children:"—"}),(0,r.jsx)(d.TD,{children:"—"}),(0,r.jsx)(d.TD,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.C,{tone:"neutral",children:"Queued"}),(0,r.jsx)("span",{className:"h-3 w-3 animate-spin rounded-full border-2 border-muted border-t-transparent"})]})}),(0,r.jsx)(d.TD,{children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,r.jsx)(i.z,{variant:"secondary",disabled:!0,children:"Set Default"})})}),(0,r.jsx)(d.TD,{children:(0,r.jsx)("span",{className:"flex h-7 w-7 items-center justify-center rounded-full border border-panelBorder text-muted",children:(0,r.jsx)(f.Z,{size:14})})})]},e.tempId)),k.map(e=>{var t,n;return(0,r.jsxs)(d.TR,{children:[(0,r.jsx)(d.TD,{className:"font-medium",children:e.name}),(0,r.jsx)(d.TD,{children:h(e.created_at)}),(0,r.jsx)(d.TD,{children:(null===(t=e.metrics)||void 0===t?void 0:t.logreg_acc)?"".concat((100*e.metrics.logreg_acc).toFixed(1),"%"):"--"}),(0,r.jsx)(d.TD,{children:(null===(n=e.metrics)||void 0===n?void 0:n.logreg_f1)?e.metrics.logreg_f1.toFixed(2):"--"}),(0,r.jsx)(d.TD,{children:e.model_id===S?(0,r.jsx)(u.C,{tone:"success",children:"Default"}):(0,r.jsx)(u.C,{tone:"neutral",children:"Available"})}),(0,r.jsx)(d.TD,{children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.model_id!==S&&(0,r.jsx)(i.z,{variant:"secondary",onClick:()=>C(e.model_id),children:"Set Default"})})}),(0,r.jsx)(d.TD,{children:(0,r.jsx)(m.default,{href:"/models/".concat(e.model_id),className:"flex h-7 w-7 items-center justify-center rounded-full border border-panelBorder text-muted transition hover:border-accent/60 hover:text-text","aria-label":"View ".concat(e.name),children:(0,r.jsx)(f.Z,{size:14})})})]},e.model_id)})]})]}):(0,r.jsx)("div",{className:"p-4 text-sm text-muted",children:"No trained models yet. Go to Train Model."})})]})}},35974:function(e,t,n){"use strict";n.d(t,{C:function(){return i}});var r=n(57437),o=n(94508);function i(e){let{className:t,tone:n="neutral",...i}=e;return(0,r.jsx)("span",{className:(0,o.cn)("inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium",{success:"bg-success/20 text-success border-success/40",warning:"bg-warn/20 text-warn border-warn/40",danger:"bg-danger/20 text-danger border-danger/40",neutral:"bg-accentSoft text-accent border-accent/40"}[n],t),...i})}},62869:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});var r=n(57437),o=n(2265),i=n(94508);let a=(0,o.forwardRef)((e,t)=>{let{className:n,variant:o="primary",loading:a=!1,disabled:s,children:l,...c}=e;return(0,r.jsxs)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-accent/60 disabled:opacity-50",{primary:"bg-accent text-white hover:opacity-90 shadow-glow",secondary:"bg-panel border border-panelBorder text-text hover:bg-accentSoft",ghost:"bg-transparent text-text hover:bg-panel",danger:"bg-danger text-white hover:opacity-90"}[o],n),disabled:s||a,"aria-busy":a||void 0,...c,children:[a&&(0,r.jsx)("span",{className:"mr-2 inline-flex h-4 w-4 animate-spin items-center justify-center rounded-full border-2 border-current border-t-transparent"}),l]})});a.displayName="Button"},66070:function(e,t,n){"use strict";n.d(t,{SZ:function(){return s},Zb:function(){return i},ll:function(){return a}});var r=n(57437),o=n(94508);function i(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,o.cn)("rounded-xl border border-panelBorder bg-panel p-4",t),...n})}function a(e){let{className:t,...n}=e;return(0,r.jsx)("h3",{className:(0,o.cn)("text-lg font-semibold",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("p",{className:(0,o.cn)("text-sm text-muted",t),...n})}},73578:function(e,t,n){"use strict";n.d(t,{Et:function(){return a},TD:function(){return d},TH:function(){return c},TR:function(){return l},XP:function(){return s},iA:function(){return i}});var r=n(57437),o=n(94508);function i(e){let{className:t,...n}=e;return(0,r.jsx)("table",{className:(0,o.cn)("w-full border-collapse text-sm",t),...n})}function a(e){let{className:t,...n}=e;return(0,r.jsx)("thead",{className:(0,o.cn)("text-left text-xs uppercase text-muted",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("tbody",{className:(0,o.cn)("divide-y divide-panelBorder",t),...n})}function l(e){let{className:t,...n}=e;return(0,r.jsx)("tr",{className:(0,o.cn)("hover:bg-panelBorder/40",t),...n})}function c(e){let{className:t,...n}=e;return(0,r.jsx)("th",{className:(0,o.cn)("px-4 py-3 font-semibold",t),...n})}function d(e){let{className:t,...n}=e;return(0,r.jsx)("td",{className:(0,o.cn)("px-4 py-3",t),...n})}},89534:function(e,t,n){"use strict";n.d(t,{ToastProvider:function(){return s},ToastViewport:function(){return c},p:function(){return l}});var r=n(57437),o=n(2265),i=n(94508);let a=(0,o.createContext)(null);function s(e){let{children:t}=e,[n,i]=(0,o.useState)([]),s=(0,o.useMemo)(()=>({toasts:n,push:e=>{let t=crypto.randomUUID();i(n=>[...n,{...e,id:t}]),setTimeout(()=>{i(e=>e.filter(e=>e.id!==t))},3200)},remove:e=>i(t=>t.filter(t=>t.id!==e))}),[n]);return(0,r.jsx)(a.Provider,{value:s,children:t})}function l(){let e=(0,o.useContext)(a);if(!e)throw Error("useToast must be used within ToastProvider");return e}function c(){let e=l();return(0,r.jsx)("div",{className:"fixed bottom-5 right-5 z-[200] flex max-w-[360px] flex-col gap-3",role:"status","aria-live":"polite",children:e.toasts.map(e=>(0,r.jsx)("div",{className:(0,i.cn)("rounded-xl border bg-panel px-4 py-3 text-sm text-text shadow-lg","success"===e.tone&&"border-success/50","error"===e.tone&&"border-danger/50","info"===e.tone&&"border-accent/50"),children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:(0,i.cn)("mt-1 inline-flex h-2.5 w-2.5 shrink-0 rounded-full","success"===e.tone&&"bg-success","error"===e.tone&&"bg-danger","info"===e.tone&&"bg-accent")}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("p",{className:"text-sm font-semibold",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-xs text-muted",children:e.description})]})]})},e.id))})}},94508:function(e,t,n){"use strict";n.d(t,{cn:function(){return i}});var r=n(61994),o=n(53335);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}},79205:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(2265);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:l,className:c="",children:d,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...a,width:o,height:o,stroke:n,strokeWidth:l?24*Number(s)/Number(o):s,className:i("lucide",c),...m},[...u.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(d)?d:[d]])}),l=(e,t)=>{let n=(0,r.forwardRef)((n,a)=>{let{className:l,...c}=n;return(0,r.createElement)(s,{ref:a,iconNode:t,className:i("lucide-".concat(o(e)),l),...c})});return n.displayName="".concat(e),n}},10407:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(79205).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},15883:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var r=n(40257);let o=function(){let e=r.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function i(e,t){let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293)),i=r.currentUser,a=i?await i.getIdToken():null,s=null==i?void 0:i.uid,l=await fetch("".concat(o).concat(e),{headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...s?{"X-Tenant-Id":s}:{}},...t});if(!l.ok)throw Error("API request failed: ".concat(l.status));return l.json()}let a={health:()=>i("/health"),predict:e=>i("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>i("/metrics"),segments:()=>i("/segments"),models:()=>i("/models"),modelDetail:e=>i("/models/".concat(e)),modelJson:e=>i("/models/".concat(e,"/json")),modelDataset:e=>i("/models/".concat(e,"/dataset")),defaultModel:()=>i("/models/default"),setDefaultModel:e=>i("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>i("/predictions"),predictionDetail:e=>i("/predictions/".concat(e)),predictionDownload:e=>i("/predictions/".concat(e,"/download")),predictionCsv:async e=>{var t;let{auth:r}=await Promise.all([n.e(139),n.e(685),n.e(293)]).then(n.bind(n,17293));return fetch("".concat(o,"/predictions/").concat(e,"/csv"),{headers:{"Content-Type":"text/csv",...(null===(t=r.currentUser)||void 0===t?void 0:t.uid)?{"X-Tenant-Id":r.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,n)=>{let r=new FormData;r.append("tenant_id",e),r.append("file",t),n&&r.append("mapping",JSON.stringify(n));let i=await fetch("".concat(o,"/upload"),{method:"POST",body:r});if(!i.ok)throw Error("Upload failed");return i.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}}},function(e){e.O(0,[432,763,648,713,971,117,744],function(){return e(e.s=97961)}),_N_E=e.O()}]);