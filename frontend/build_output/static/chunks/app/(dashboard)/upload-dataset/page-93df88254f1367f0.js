(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283,293],{20067:function(){},72061:function(){},71849:function(e,t,r){Promise.resolve().then(r.bind(r,4858))},4858:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(57437),a=r(2265),s=r(2093);let i=[{key:"customer_id",label:"Customer ID"},{key:"order_id",label:"Order/Invoice ID"},{key:"order_datetime",label:"Order Date/Time"},{key:"product_id",label:"Product/SKU ID"}],o=[{key:"quantity",label:"Quantity"},{key:"unit_price",label:"Unit Price"},{key:"order_total",label:"Order Total"}];var l=r(66070),d=r(32489),c=r(62869),u=r(53647),m=r(95186),p=r(89534),f=r(15883),h=r(46413),x=r(99376);function g(){let[e,t]=(0,a.useState)([]),[r,g]=(0,a.useState)({}),[b,v]=(0,a.useState)(null),[y,j]=(0,a.useState)(null),[w,N]=(0,a.useState)(""),[k,S]=(0,a.useState)(!1),[P,C]=(0,a.useState)(!1),[_,T]=(0,a.useState)(0),D=(0,a.useRef)(null),{push:I}=(0,p.p)(),{user:B}=(0,h.a)(),O=(0,x.useRouter)(),E=(0,a.useCallback)(async e=>{let r=await e.arrayBuffer(),n=s.ij(r,{type:"array"}),a=n.SheetNames[0],i=n.Sheets[a];t((s.P6.sheet_to_json(i,{header:1})[0]||[]).map(e=>String(e)).filter(Boolean))},[]),q=async e=>{v(e.name),j(e),C(!0),T(0),D.current&&window.clearInterval(D.current),D.current=window.setInterval(()=>{T(e=>e<90?e+8:e)},120),await new Promise(e=>setTimeout(e,0)),await E(e),T(100),D.current&&(window.clearInterval(D.current),D.current=null),setTimeout(()=>C(!1),250)},U=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&await q(r)},A=(e,t)=>{g(r=>({...r,[e]:t}))},J=i.every(e=>r[e.key]),R=(0,a.useMemo)(()=>new Set(Object.values(r).filter(Boolean)),[r]),Z=(0,a.useCallback)(t=>{let n=r[t];return e.filter(e=>e===n||!R.has(e))},[e,r,R]),z=async()=>{if(!J){I({title:"Complete required mapping.",description:"Map all required fields before training.",tone:"error"});return}if(!y){I({title:"Upload a dataset.",description:"Select a CSV or Excel file to continue.",tone:"error"});return}if(!B){I({title:"Login required.",description:"Sign in to train a model.",tone:"error"});return}S(!0);try{var e;let t=await f.h.uploadDataset(B.uid,y,r);await f.h.retrain({tenant_id:B.uid,dataset_path:t.dataset_path,mapping_path:t.mapping_path,notify_email:B.email});let n=JSON.parse(null!==(e=window.localStorage.getItem("pending-models"))&&void 0!==e?e:"[]"),a=(null==w?void 0:w.trim())||"New model",s=[{tempId:"queued-".concat(Date.now()),name:a,createdAt:Date.now()},...n];window.localStorage.setItem("pending-models",JSON.stringify(s)),I({title:"Training queued.",description:"We will email you when the model is ready.",tone:"success"}),O.push("/models")}catch(e){I({title:"Training failed.",description:"Check the API connection and try again.",tone:"error"})}finally{S(!1)}},L=async e=>{var t;e.preventDefault();let r=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];r&&await q(r)};return(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)(l.ll,{children:"Upload Dataset"}),(0,n.jsx)(l.SZ,{children:"Upload a CSV/Excel file, name the dataset, then map your columns."})]}),(0,n.jsxs)("div",{className:"mt-5 space-y-5",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-background p-4",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Dataset label"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Provide a label to identify this dataset or model in your workspace."}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(m.I,{placeholder:"e.g. Retail v3 - January upload",value:w,onChange:e=>N(e.target.value)})})]}),b?(0,n.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-panelBorder bg-background px-4 py-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase text-muted",children:"Uploaded file"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-text",children:b}),P&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"h-1.5 w-48 overflow-hidden rounded-full bg-panelBorder/60",children:(0,n.jsx)("div",{className:"h-full bg-accent transition-all",style:{width:"".concat(_,"%")}})}),(0,n.jsx)("p",{className:"mt-1 text-[11px] text-muted",children:"Processing file..."})]})]}),(0,n.jsx)(c.z,{variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>{v(null),j(null),t([]),g({}),C(!1),T(0),D.current&&(window.clearInterval(D.current),D.current=null)},"aria-label":"Remove file",disabled:P,children:(0,n.jsx)(d.Z,{size:16})})]}):(0,n.jsxs)("div",{className:"rounded-xl border border-dashed border-panelBorder bg-background p-8 text-center",onDrop:L,onDragOver:e=>e.preventDefault(),children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Upload dataset"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Drag & drop CSV/XLSX, or browse to upload."}),(0,n.jsxs)("label",{className:"mt-4 inline-flex cursor-pointer items-center justify-center rounded-md border border-panelBorder px-4 py-2 text-sm",children:["Choose file",(0,n.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",className:"hidden",onChange:U})]})]}),b&&!P&&(0,n.jsxs)("div",{className:"grid gap-4 lg:grid-cols-2",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Required fields"}),(0,n.jsx)("div",{className:"mt-3 grid gap-3",children:i.map(e=>{var t;return(0,n.jsxs)("div",{className:"grid gap-2 md:grid-cols-[1fr_1.2fr]",children:[(0,n.jsx)("span",{className:"text-xs text-muted",children:e.label}),(0,n.jsxs)(u.P,{value:null!==(t=r[e.key])&&void 0!==t?t:"",onChange:t=>A(e.key,t.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select column"}),Z(e.key).map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]},e.key)})})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Optional fields"}),(0,n.jsx)("div",{className:"mt-3 grid gap-3",children:o.map(e=>{var t;return(0,n.jsxs)("div",{className:"grid gap-2 md:grid-cols-[1fr_1.2fr]",children:[(0,n.jsx)("span",{className:"text-xs text-muted",children:e.label}),(0,n.jsxs)(u.P,{value:null!==(t=r[e.key])&&void 0!==t?t:"",onChange:t=>A(e.key,t.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select column"}),Z(e.key).map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]},e.key)})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-panelBorder bg-background p-4 lg:col-span-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Train model"}),(0,n.jsx)("p",{className:"text-xs text-muted",children:"We will validate your mapping and start training."})]}),(0,n.jsx)(c.z,{onClick:z,disabled:k,loading:k,children:"Train Model"})]})]})]})]})}function b(){return(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsx)(g,{})})}},46413:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return d}});var n=r(57437),a=r(43301),s=r(2265),i=r(17293);let o=(0,s.createContext)({user:null,loading:!0});function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=(0,a.Aj)(i.auth,e=>{l(e),c(!1)});return()=>e()},[]),(0,n.jsx)(o.Provider,{value:{user:r,loading:d},children:t})}function d(){return(0,s.useContext)(o)}},62869:function(e,t,r){"use strict";r.d(t,{z:function(){return i}});var n=r(57437),a=r(2265),s=r(94508);let i=(0,a.forwardRef)((e,t)=>{let{className:r,variant:a="primary",loading:i=!1,disabled:o,children:l,...d}=e;return(0,n.jsxs)("button",{ref:t,className:(0,s.cn)("inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-accent/60 disabled:opacity-50",{primary:"bg-accent text-white hover:opacity-90 shadow-glow",secondary:"bg-panel border border-panelBorder text-text hover:bg-accentSoft",ghost:"bg-transparent text-text hover:bg-panel",danger:"bg-danger text-white hover:opacity-90"}[a],r),disabled:o||i,"aria-busy":i||void 0,...d,children:[i&&(0,n.jsx)("span",{className:"mr-2 inline-flex h-4 w-4 animate-spin items-center justify-center rounded-full border-2 border-current border-t-transparent"}),l]})});i.displayName="Button"},66070:function(e,t,r){"use strict";r.d(t,{SZ:function(){return o},Zb:function(){return s},ll:function(){return i}});var n=r(57437),a=r(94508);function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,a.cn)("rounded-xl border border-panelBorder bg-panel p-4",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("h3",{className:(0,a.cn)("text-lg font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,n.jsx)("p",{className:(0,a.cn)("text-sm text-muted",t),...r})}},95186:function(e,t,r){"use strict";r.d(t,{I:function(){return s}});var n=r(57437),a=r(94508);function s(e){let{className:t,...r}=e;return(0,n.jsx)("input",{className:(0,a.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text placeholder:text-muted focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...r})}},53647:function(e,t,r){"use strict";r.d(t,{P:function(){return s}});var n=r(57437),a=r(94508);function s(e){let{className:t,...r}=e;return(0,n.jsx)("select",{className:(0,a.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...r})}},89534:function(e,t,r){"use strict";r.d(t,{ToastProvider:function(){return o},ToastViewport:function(){return d},p:function(){return l}});var n=r(57437),a=r(2265),s=r(94508);let i=(0,a.createContext)(null);function o(e){let{children:t}=e,[r,s]=(0,a.useState)([]),o=(0,a.useMemo)(()=>({toasts:r,push:e=>{let t=crypto.randomUUID();s(r=>[...r,{...e,id:t}]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==t))},3200)},remove:e=>s(t=>t.filter(t=>t.id!==e))}),[r]);return(0,n.jsx)(i.Provider,{value:o,children:t})}function l(){let e=(0,a.useContext)(i);if(!e)throw Error("useToast must be used within ToastProvider");return e}function d(){let e=l();return(0,n.jsx)("div",{className:"fixed bottom-5 right-5 z-[200] flex max-w-[360px] flex-col gap-3",role:"status","aria-live":"polite",children:e.toasts.map(e=>(0,n.jsx)("div",{className:(0,s.cn)("rounded-xl border bg-panel px-4 py-3 text-sm text-text shadow-lg","success"===e.tone&&"border-success/50","error"===e.tone&&"border-danger/50","info"===e.tone&&"border-accent/50"),children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:(0,s.cn)("mt-1 inline-flex h-2.5 w-2.5 shrink-0 rounded-full","success"===e.tone&&"bg-success","error"===e.tone&&"bg-danger","info"===e.tone&&"bg-accent")}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:e.title}),e.description&&(0,n.jsx)("p",{className:"text-xs text-muted",children:e.description})]})]})},e.id))})}},17293:function(e,t,r){"use strict";r.d(t,{auth:function(){return i}});var n=r(738),a=r(43301);let s=(0,n.C6)().length?(0,n.C6)()[0]:(0,n.ZF)({apiKey:"AIzaSyDB__J1ECJXzPeF1DrLPa4Y5570JlnmQ_s",authDomain:"csr-a90c3.firebaseapp.com",projectId:"csr-a90c3",storageBucket:"csr-a90c3.firebasestorage.app",messagingSenderId:"998738090664",appId:"1:998738090664:web:e8d71b492d4175623d009d"}),i=(0,a.v0)(s)},94508:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(61994),a=r(53335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},79205:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:d="",children:c,iconNode:u,...m}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:l?24*Number(o)/Number(a):o,className:s("lucide",d),...m},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),l=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:l,...d}=r;return(0,n.createElement)(o,{ref:i,iconNode:t,className:s("lucide-".concat(a(e)),l),...d})});return r.displayName="".concat(e),r}},32489:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},99376:function(e,t,r){"use strict";var n=r(35475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},15883:function(e,t,r){"use strict";r.d(t,{h:function(){return i}});var n=r(40257);let a=function(){let e=n.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function s(e,t){let{auth:n}=await Promise.all([r.e(139),r.e(685),r.e(293)]).then(r.bind(r,17293)),s=n.currentUser,i=s?await s.getIdToken():null,o=null==s?void 0:s.uid,l=await fetch("".concat(a).concat(e),{headers:{"Content-Type":"application/json",...i?{Authorization:"Bearer ".concat(i)}:{},...o?{"X-Tenant-Id":o}:{}},...t});if(!l.ok)throw Error("API request failed: ".concat(l.status));return l.json()}let i={health:()=>s("/health"),predict:e=>s("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>s("/metrics"),segments:()=>s("/segments"),models:()=>s("/models"),modelDetail:e=>s("/models/".concat(e)),modelJson:e=>s("/models/".concat(e,"/json")),modelDataset:e=>s("/models/".concat(e,"/dataset")),defaultModel:()=>s("/models/default"),setDefaultModel:e=>s("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>s("/predictions"),predictionDetail:e=>s("/predictions/".concat(e)),predictionDownload:e=>s("/predictions/".concat(e,"/download")),predictionCsv:async e=>{var t;let{auth:n}=await Promise.all([r.e(139),r.e(685),r.e(293)]).then(r.bind(r,17293));return fetch("".concat(a,"/predictions/").concat(e,"/csv"),{headers:{"Content-Type":"text/csv",...(null===(t=n.currentUser)||void 0===t?void 0:t.uid)?{"X-Tenant-Id":n.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,r)=>{let n=new FormData;n.append("tenant_id",e),n.append("file",t),r&&n.append("mapping",JSON.stringify(r));let s=await fetch("".concat(a,"/upload"),{method:"POST",body:n});if(!s.ok)throw Error("Upload failed");return s.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}}},function(e){e.O(0,[139,425,432,685,971,117,744],function(){return e(e.s=71849)}),_N_E=e.O()}]);