(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97,293],{70831:function(e,t,r){Promise.resolve().then(r.bind(r,5505))},5505:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(57437),i=r(2265),o=r(11713),a=r(66070),s=r(15883),d=r(27648),l=r(53647),c=r(95186),u=r(62869),m=r(46413),p=r(89534),h=r(32489),x=r(94508);function f(e){if(!e)return"—";let t=null;if(e instanceof Date&&(t=e),"number"==typeof e&&(t=new Date(e)),"string"==typeof e){let r=new Date(e);t=Number.isNaN(r.getTime())?null:r}if(e.seconds&&(t=new Date(1e3*e.seconds)),e._seconds&&(t=new Date(1e3*e._seconds)),e.toDate&&(t=e.toDate()),e.toMillis&&(t=new Date(e.toMillis())),!t)return"—";let r=Date.now()-t.getTime();if(r<0)return"just now";let n=Math.floor(r/1e3),i=Math.floor(n/60),o=Math.floor(i/60),a=Math.floor(o/24),s=Math.floor(a/30);return n<60?"".concat(n,"s ago"):i<60?"".concat(i,"m ago"):o<24?"".concat(o,"h ago"):a<30?"".concat(a,"d ago"):s<12?"".concat(s,"mo ago"):"".concat(Math.floor(a/365),"y ago")}function b(){var e;let{user:t}=(0,m.a)(),{push:r}=(0,p.p)(),[b,g]=(0,i.useState)(""),[v,j]=(0,i.useState)(""),[y,N]=(0,i.useState)(!1),[w,S]=(0,i.useState)("single"),[_,C]=(0,i.useState)(!1),[k,B]=(0,i.useState)(!1),[P,D]=(0,i.useState)([]),I=(0,i.useRef)(0),q=(0,o.a)({queryKey:["models"],queryFn:s.h.models,refetchInterval:5e3}),T=(0,o.a)({queryKey:["predictions"],queryFn:s.h.predictions,refetchInterval:5e3}),E=(0,i.useMemo)(()=>{var e;return(null!==(e=T.data)&&void 0!==e?e:[]).filter(e=>{var t;return(null===(t=e.payload)||void 0===t?void 0:t.mode)==="batch"})},[T.data]),M=(0,i.useMemo)(()=>{var e;let t=new Map;return(null!==(e=q.data)&&void 0!==e?e:[]).forEach(e=>{t.set(e.model_id,e.name)}),t},[q.data]),A=(0,i.useMemo)(()=>{var e;return[...P.map(e=>({prediction_id:e.tempId,payload:{model_id:e.modelId,mode:e.mode},created_at:new Date(e.createdAt).toISOString(),isQueued:!0})),...null!==(e=T.data)&&void 0!==e?e:[]]},[P,T.data]),O=P.length;(0,i.useEffect)(()=>{let e=E.length,t=e-I.current;t>0&&P.length&&D(e=>e.slice(Math.min(t,e.length))),I.current=e},[E.length,P.length]);let z=async()=>{if(!t){r({title:"Login required.",description:"Sign in to run predictions.",tone:"error"});return}if(!b){r({title:"Select a model.",description:"Choose a trained model first.",tone:"error"});return}let e=Number(v);if(!e){r({title:"Enter a valid customer ID.",description:"Use a numeric customer ID.",tone:"error"});return}C(!0);try{await s.h.queueSinglePrediction({tenant_id:t.uid,model_id:b,customer_id:e,notify_email:t.email}),r({title:"Single prediction queued.",description:"We will email you when the result is ready.",tone:"success"}),D(e=>[{tempId:"queued-".concat(Date.now(),"-single"),modelId:b,createdAt:Date.now(),mode:"single"},...e]),j(""),N(!1)}catch(e){r({title:"Prediction failed.",description:"Check the customer ID and API connection.",tone:"error"})}finally{C(!1)}},J=async()=>{if(!t){r({title:"Login required.",description:"Sign in to run predictions.",tone:"error"});return}if(!b){r({title:"Select a model.",description:"Choose a trained model first.",tone:"error"});return}B(!0);try{await s.h.queueBatchPrediction({tenant_id:t.uid,model_id:b,notify_email:t.email}),D(e=>[{tempId:"queued-".concat(Date.now(),"-batch"),modelId:b,createdAt:Date.now(),mode:"batch"},...e]),r({title:"Batch prediction queued.",description:"We will email you when the file is ready.",tone:"success"}),N(!1)}catch(e){r({title:"Batch prediction failed.",description:"Check the API connection and try again.",tone:"error"})}finally{B(!1)}};return(0,n.jsxs)(a.Zb,{children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(a.ll,{children:"Prediction Console"}),(0,n.jsx)(a.SZ,{children:"Run single or batch predictions and review batch history."})]}),(0,n.jsx)(u.z,{onClick:()=>N(!0),children:"Create prediction"})]}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Prediction runs"}),(0,n.jsx)("p",{className:"text-xs text-muted",children:O?"".concat(O," queued"):"Open a run to view full results."})]}),(0,n.jsx)(u.z,{variant:"ghost",className:"h-9",onClick:()=>T.refetch(),disabled:T.isFetching,children:"Refresh"})]}),(0,n.jsxs)("div",{className:"mt-3 grid gap-3",children:[0===A.length&&(0,n.jsx)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 text-sm text-muted",children:"No batch runs yet."}),A.map(e=>{var t,r,i,o,a,s,l,c,u,m,p,h;return e.isQueued?(0,n.jsx)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 opacity-70",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:(null===(t=e.payload)||void 0===t?void 0:t.mode)==="single"?"Single prediction":"Batch prediction"}),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Model: ",M.get(null===(r=e.payload)||void 0===r?void 0:r.model_id)||"—"," \xb7"," ",f(e.created_at)]})]}),(0,n.jsx)("span",{className:"rounded-full border border-panelBorder bg-panel px-2 py-1 text-xs text-muted",children:"Queued"})]})},e.prediction_id):(0,n.jsx)(d.default,{href:(null===(i=e.payload)||void 0===i?void 0:i.mode)==="batch"?"/predictions/batch/".concat(e.prediction_id):"/predictions/".concat(e.prediction_id),className:"rounded-xl border border-panelBorder bg-background p-4 transition hover:border-accent/60",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:(null===(o=e.payload)||void 0===o?void 0:o.mode)==="single"?"Single prediction":"Batch prediction"}),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Model: ",M.get(null===(a=e.payload)||void 0===a?void 0:a.model_id)||"—"," \xb7"," ",f(e.created_at)]})]}),(0,n.jsx)("p",{className:"text-xs text-muted",children:(null===(s=e.payload)||void 0===s?void 0:s.mode)==="batch"?"".concat(null!==(m=null===(l=e.result)||void 0===l?void 0:l.count)&&void 0!==m?m:"—"," customers"):"Customer ".concat(null!==(h=null!==(p=null===(c=e.result)||void 0===c?void 0:c.customer_id)&&void 0!==p?p:null===(u=e.payload)||void 0===u?void 0:u.customer_id)&&void 0!==h?h:"—")})]})},e.prediction_id)})]})]}),y&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-6",children:(0,n.jsxs)("div",{className:"w-full max-w-3xl rounded-2xl border border-panelBorder bg-panel",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-panelBorder px-6 py-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase text-muted",children:"Prediction"}),(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Create prediction"})]}),(0,n.jsx)(u.z,{variant:"ghost",className:"h-9 w-9 p-0",onClick:()=>N(!1),"aria-label":"Close",children:(0,n.jsx)(h.Z,{size:16})})]}),(0,n.jsxs)("div",{className:"grid gap-4 p-6 md:grid-cols-2",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 md:col-span-2",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Select model"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Choose a trained model."}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsxs)(l.P,{value:b,onChange:e=>g(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select model"}),(null!==(e=q.data)&&void 0!==e?e:[]).map(e=>(0,n.jsx)("option",{value:e.model_id,children:e.name},e.model_id))]})})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-background p-4 md:col-span-2",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Prediction type"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Choose a single customer or a full batch."}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>S("single"),className:(0,x.cn)("flex-1 rounded-lg border border-panelBorder px-3 py-2 text-left text-sm transition","single"===w?"bg-accentSoft text-text":"bg-panel text-muted hover:bg-panelBorder/50 hover:text-text"),children:"Single prediction"}),(0,n.jsx)("button",{type:"button",onClick:()=>S("batch"),className:(0,x.cn)("flex-1 rounded-lg border border-panelBorder px-3 py-2 text-left text-sm transition","batch"===w?"bg-accentSoft text-text":"bg-panel text-muted hover:bg-panelBorder/50 hover:text-text"),children:"Batch prediction"})]})]}),"single"===w?(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4 md:col-span-2",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Single prediction"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Enter a customer ID to run a prediction."}),(0,n.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-[1fr_auto] md:items-center",children:[(0,n.jsx)(c.I,{placeholder:"Customer ID",value:v,onChange:e=>j(e.target.value)}),(0,n.jsx)(u.z,{onClick:z,disabled:!v||!b,loading:_,children:"Run single prediction"})]})]}):(0,n.jsxs)("div",{className:"rounded-xl border border-panelBorder bg-panel p-4 md:col-span-2",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"Batch prediction"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Run predictions for all customers in the model dataset."}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(u.z,{onClick:J,disabled:!b,loading:k,children:"Run batch prediction"})})]})]})]})})]})}},46413:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return d},a:function(){return l}});var n=r(57437),i=r(43301),o=r(2265),a=r(17293);let s=(0,o.createContext)({user:null,loading:!0});function d(e){let{children:t}=e,[r,d]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let e=(0,i.Aj)(a.auth,e=>{d(e),c(!1)});return()=>e()},[]),(0,n.jsx)(s.Provider,{value:{user:r,loading:l},children:t})}function l(){return(0,o.useContext)(s)}},62869:function(e,t,r){"use strict";r.d(t,{z:function(){return a}});var n=r(57437),i=r(2265),o=r(94508);let a=(0,i.forwardRef)((e,t)=>{let{className:r,variant:i="primary",loading:a=!1,disabled:s,children:d,...l}=e;return(0,n.jsxs)("button",{ref:t,className:(0,o.cn)("inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-accent/60 disabled:opacity-50",{primary:"bg-accent text-white hover:opacity-90 shadow-glow",secondary:"bg-panel border border-panelBorder text-text hover:bg-accentSoft",ghost:"bg-transparent text-text hover:bg-panel",danger:"bg-danger text-white hover:opacity-90"}[i],r),disabled:s||a,"aria-busy":a||void 0,...l,children:[a&&(0,n.jsx)("span",{className:"mr-2 inline-flex h-4 w-4 animate-spin items-center justify-center rounded-full border-2 border-current border-t-transparent"}),d]})});a.displayName="Button"},66070:function(e,t,r){"use strict";r.d(t,{SZ:function(){return s},Zb:function(){return o},ll:function(){return a}});var n=r(57437),i=r(94508);function o(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,i.cn)("rounded-xl border border-panelBorder bg-panel p-4",t),...r})}function a(e){let{className:t,...r}=e;return(0,n.jsx)("h3",{className:(0,i.cn)("text-lg font-semibold",t),...r})}function s(e){let{className:t,...r}=e;return(0,n.jsx)("p",{className:(0,i.cn)("text-sm text-muted",t),...r})}},95186:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var n=r(57437),i=r(94508);function o(e){let{className:t,...r}=e;return(0,n.jsx)("input",{className:(0,i.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text placeholder:text-muted focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...r})}},53647:function(e,t,r){"use strict";r.d(t,{P:function(){return o}});var n=r(57437),i=r(94508);function o(e){let{className:t,...r}=e;return(0,n.jsx)("select",{className:(0,i.cn)("h-10 w-full rounded-md border border-panelBorder bg-background px-3 text-sm text-text focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40",t),...r})}},89534:function(e,t,r){"use strict";r.d(t,{ToastProvider:function(){return s},ToastViewport:function(){return l},p:function(){return d}});var n=r(57437),i=r(2265),o=r(94508);let a=(0,i.createContext)(null);function s(e){let{children:t}=e,[r,o]=(0,i.useState)([]),s=(0,i.useMemo)(()=>({toasts:r,push:e=>{let t=crypto.randomUUID();o(r=>[...r,{...e,id:t}]),setTimeout(()=>{o(e=>e.filter(e=>e.id!==t))},3200)},remove:e=>o(t=>t.filter(t=>t.id!==e))}),[r]);return(0,n.jsx)(a.Provider,{value:s,children:t})}function d(){let e=(0,i.useContext)(a);if(!e)throw Error("useToast must be used within ToastProvider");return e}function l(){let e=d();return(0,n.jsx)("div",{className:"fixed bottom-5 right-5 z-[200] flex max-w-[360px] flex-col gap-3",role:"status","aria-live":"polite",children:e.toasts.map(e=>(0,n.jsx)("div",{className:(0,o.cn)("rounded-xl border bg-panel px-4 py-3 text-sm text-text shadow-lg","success"===e.tone&&"border-success/50","error"===e.tone&&"border-danger/50","info"===e.tone&&"border-accent/50"),children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:(0,o.cn)("mt-1 inline-flex h-2.5 w-2.5 shrink-0 rounded-full","success"===e.tone&&"bg-success","error"===e.tone&&"bg-danger","info"===e.tone&&"bg-accent")}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:e.title}),e.description&&(0,n.jsx)("p",{className:"text-xs text-muted",children:e.description})]})]})},e.id))})}},17293:function(e,t,r){"use strict";r.d(t,{auth:function(){return a}});var n=r(738),i=r(43301);let o=(0,n.C6)().length?(0,n.C6)()[0]:(0,n.ZF)({apiKey:"AIzaSyDB__J1ECJXzPeF1DrLPa4Y5570JlnmQ_s",authDomain:"csr-a90c3.firebaseapp.com",projectId:"csr-a90c3",storageBucket:"csr-a90c3.firebasestorage.app",messagingSenderId:"998738090664",appId:"1:998738090664:web:e8d71b492d4175623d009d"}),a=(0,i.v0)(o)},94508:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var n=r(61994),i=r(53335);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.m6)((0,n.W)(t))}},79205:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(2265);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:d,className:l="",children:c,iconNode:u,...m}=e;return(0,n.createElement)("svg",{ref:t,...a,width:i,height:i,stroke:r,strokeWidth:d?24*Number(s)/Number(i):s,className:o("lucide",l),...m},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),d=(e,t)=>{let r=(0,n.forwardRef)((r,a)=>{let{className:d,...l}=r;return(0,n.createElement)(s,{ref:a,iconNode:t,className:o("lucide-".concat(i(e)),d),...l})});return r.displayName="".concat(e),r}},32489:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},15883:function(e,t,r){"use strict";r.d(t,{h:function(){return a}});var n=r(40257);let i=function(){let e=n.env.NEXT_PUBLIC_API_BASE_URL;return e&&e.trim()?e.trim():"https://csr-vx85.onrender.com"}();async function o(e,t){let{auth:n}=await Promise.all([r.e(139),r.e(685),r.e(293)]).then(r.bind(r,17293)),o=n.currentUser,a=o?await o.getIdToken():null,s=null==o?void 0:o.uid,d=await fetch("".concat(i).concat(e),{headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...s?{"X-Tenant-Id":s}:{}},...t});if(!d.ok)throw Error("API request failed: ".concat(d.status));return d.json()}let a={health:()=>o("/health"),predict:e=>o("/predict",{method:"POST",body:JSON.stringify(e)}),metrics:()=>o("/metrics"),segments:()=>o("/segments"),models:()=>o("/models"),modelDetail:e=>o("/models/".concat(e)),modelJson:e=>o("/models/".concat(e,"/json")),modelDataset:e=>o("/models/".concat(e,"/dataset")),defaultModel:()=>o("/models/default"),setDefaultModel:e=>o("/models/default",{method:"POST",body:JSON.stringify({model_id:e})}),predictions:()=>o("/predictions"),predictionDetail:e=>o("/predictions/".concat(e)),predictionDownload:e=>o("/predictions/".concat(e,"/download")),predictionCsv:async e=>{var t;let{auth:n}=await Promise.all([r.e(139),r.e(685),r.e(293)]).then(r.bind(r,17293));return fetch("".concat(i,"/predictions/").concat(e,"/csv"),{headers:{"Content-Type":"text/csv",...(null===(t=n.currentUser)||void 0===t?void 0:t.uid)?{"X-Tenant-Id":n.currentUser.uid}:{}}})},retrain:async e=>{let t=await fetch("/api/queue/train",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue training");return t.json()},uploadDataset:async(e,t,r)=>{let n=new FormData;n.append("tenant_id",e),n.append("file",t),r&&n.append("mapping",JSON.stringify(r));let o=await fetch("".concat(i,"/upload"),{method:"POST",body:n});if(!o.ok)throw Error("Upload failed");return o.json()},queueSinglePrediction:async e=>{let t=await fetch("/api/queue/predict-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text()||"Failed to queue single prediction");return t.json()},queueBatchPrediction:async e=>{let t=await fetch("/api/queue/predict-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to queue batch prediction");return t.json()}}}},function(e){e.O(0,[139,432,685,763,648,713,971,117,744],function(){return e(e.s=70831)}),_N_E=e.O()}]);